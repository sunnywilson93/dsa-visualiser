---
phase: 16-config-token-migration
plan: 06
type: execute
wave: 6
depends_on: ["16-05"]
files_modified:
  - src/styles/globals.css
  - src/components/ErrorBoundary/ErrorBoundary.module.css
  - src/components/EventLoopPlayground/EventLoopDisplay.module.css
  - src/components/Visualization/ArrayVisualization.module.css
  - src/components/Concepts/StateEvolutionViz.module.css
  - src/components/Concepts/VariablesViz.module.css
  - src/components/Concepts/FunctionsViz.module.css
  - src/components/Concepts/BuildToolsEvolutionViz.module.css
  - src/components/Concepts/EventLoopViz.module.css
  - src/components/Concepts/ObjectsBasicsViz.module.css
  - src/components/Concepts/ModuleEvolutionViz.module.css
  - src/components/Concepts/ArraysBasicsViz.module.css
  - src/components/Concepts/StreamsBuffersViz.module.css
  - src/components/Concepts/AsyncEvolutionViz.module.css
  - src/components/Concepts/WebEvolutionViz.module.css
autonomous: true

must_haves:
  truths:
    - "Custom breakpoints (360px, 400px, 480px) are in @theme with --breakpoint-* namespace"
    - "All shared/duplicated keyframe animations are consolidated in @theme"
    - "Each keyframe is defined exactly once in @theme (no duplicates)"
    - "--animate-* tokens exist for each keyframe animation"
    - "CSS Modules no longer contain duplicate @keyframes that are now in @theme"
    - "CSS Module animation properties reference global keyframe names"
    - "No scattered @keyframes exist outside @theme (except unique box-shadow variants)"
    - "App builds successfully and all animations work"
  artifacts:
    - path: "src/styles/globals.css"
      provides: "All keyframe definitions and --animate-* tokens in @theme, plus --breakpoint-* tokens"
      contains: "@keyframes fadeIn"
  key_links:
    - from: "*.module.css animation property"
      to: "@theme @keyframes"
      via: "Global keyframe name reference"
      pattern: "animation.*fadeIn|animation.*pulse|animation.*spin"
---

<objective>
Breakpoints & Animations Migration -- Add custom breakpoints to @theme and consolidate all keyframe animations from 16 CSS files into the @theme block. Deduplicate the 26 @keyframes definitions down to unique animations.

Purpose: Custom breakpoints enable responsive variant syntax (mobile:grid-cols-2). Consolidating keyframes eliminates 10x duplication of pulse, 3x fadeIn, 2x spin etc. and creates a single source of truth with --animate-* tokens.
Output: Custom breakpoints in @theme, all keyframes consolidated in @theme, CSS Modules cleaned of duplicate @keyframes, --animate-* shorthand tokens defined.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-config-token-migration/16-RESEARCH.md
@.planning/phases/16-config-token-migration/16-05-SUMMARY.md
@src/styles/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add breakpoints and animation tokens to @theme</name>
  <files>src/styles/globals.css</files>
  <action>
    In the `@theme` block (after the shadow section), add breakpoints and animations:

    ```css
    /* === Breakpoints === */
    --breakpoint-2xs: 360px;
    --breakpoint-xs: 400px;
    --breakpoint-mobile: 480px;

    /* === Easing === */
    --ease-default: ease;
    --ease-in-out: ease-in-out;
    --ease-out: ease-out;

    /* === Animation Tokens === */
    --animate-fade-in: fadeIn 0.2s ease-out;
    --animate-fade-in-scale: fadeInScale 0.3s ease-out;
    --animate-slide-in: slideIn 0.2s ease-out;
    --animate-pulse: pulse 2s ease-in-out infinite;
    --animate-spin: spin 1s linear infinite;
    --animate-float: float 1s ease-in-out infinite;
    --animate-pointer-pulse: pointerPulse 1.5s ease-in-out infinite;
    --animate-border-pulse: borderPulse 2s ease-in-out infinite;
    --animate-icon-pulse: iconPulse 1.5s ease-in-out infinite;
    --animate-warning-pulse: warningPulse 1.5s ease-in-out infinite;
    --animate-extract-pulse: extractPulse 0.8s ease-in-out infinite;
    --animate-spread-out: spreadOut 0.5s ease-out;
    --animate-spread-in: spreadIn 0.6s ease-out;

    /* === Keyframe Definitions === */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes slideIn {
      from { transform: translateY(-10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    @keyframes pointerPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
    @keyframes borderPulse {
      0%, 100% { border-color: rgba(88, 166, 255, 0.3); }
      50% { border-color: rgba(88, 166, 255, 0.6); }
    }
    @keyframes iconPulse {
      0%, 100% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.1); opacity: 1; }
    }
    @keyframes warningPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(219, 109, 40, 0); }
      50% { box-shadow: 0 0 8px 2px rgba(219, 109, 40, 0.3); }
    }
    @keyframes extractPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(88, 166, 255, 0); }
      50% { box-shadow: 0 0 8px 2px rgba(88, 166, 255, 0.3); }
    }
    @keyframes spreadOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(20px); opacity: 0.7; }
    }
    @keyframes spreadIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    ```

    Also remove the existing @keyframes and .animate-* classes from the `@layer utilities` block at the bottom of globals.css (pulse, slideIn, fadeIn, .animate-pulse, .animate-slide-in, .animate-fade-in). These are now replaced by @theme-generated utilities.

    **Keyframe deduplication notes:**
    - `pulse` has 3 variants across modules: generic opacity pulse (promoted), teal box-shadow pulse, orange box-shadow pulse. Only the generic opacity one goes in @theme. The box-shadow variants in specific CSS Modules should check if they match warningPulse or extractPulse above. If they have different colors/sizes, they stay as local module keyframes.
    - `fadeIn` has 2 variants: simple opacity (promoted as fadeIn) and opacity+scale (promoted as fadeInScale)
    - Verify each CSS Module's actual keyframe body before removing. If a module's pulse uses box-shadow instead of opacity, it should keep its local @keyframes OR be mapped to warningPulse/extractPulse.
  </action>
  <verify>
    - `grep "\-\-breakpoint-2xs" src/styles/globals.css` shows 360px in @theme
    - `grep "\-\-animate-pulse" src/styles/globals.css` shows animation token in @theme
    - `grep "@keyframes fadeIn" src/styles/globals.css` shows keyframe in @theme
    - No @keyframes remain in the @layer utilities block of globals.css
    - No .animate-pulse, .animate-slide-in, .animate-fade-in classes remain in globals.css utilities
  </verify>
  <done>Breakpoints, animation tokens, and all keyframe definitions in @theme. Old utility-layer animations removed.</done>
</task>

<task type="auto">
  <name>Task 2: Remove duplicate @keyframes from CSS Modules</name>
  <files>15 CSS Module files (see files_modified list)</files>
  <action>
    For each CSS Module file that contains @keyframes duplicated in @theme, do the following:

    1. Read the file and check each @keyframes definition
    2. Compare the keyframe body to the @theme version
    3. If IDENTICAL (same property, same values): Remove the local @keyframes block
    4. If DIFFERENT (e.g., uses box-shadow instead of opacity for pulse): Keep local @keyframes OR rename to match the appropriate @theme keyframe

    **Files to process (from research):**

    **pulse (opacity variant -- remove from these, matches @theme):**
    - src/components/Concepts/StateEvolutionViz.module.css
    - src/components/Concepts/VariablesViz.module.css
    - src/components/Concepts/FunctionsViz.module.css
    - src/components/Concepts/BuildToolsEvolutionViz.module.css
    - src/components/Concepts/ObjectsBasicsViz.module.css (check: has 2 keyframes, pulse + fadeIn)
    - src/components/Concepts/ModuleEvolutionViz.module.css
    - src/components/Concepts/ArraysBasicsViz.module.css (check: has multiple keyframes)
    - src/components/Concepts/StreamsBuffersViz.module.css
    - src/components/Concepts/AsyncEvolutionViz.module.css
    - src/components/Concepts/WebEvolutionViz.module.css

    **spin (remove from these, matches @theme):**
    - src/components/EventLoopPlayground/EventLoopDisplay.module.css
    - src/components/Concepts/EventLoopViz.module.css

    **fadeIn (remove from these, matches @theme):**
    - src/components/Concepts/ObjectsBasicsViz.module.css
    - src/components/Concepts/ArraysBasicsViz.module.css

    **float (remove, matches @theme):**
    - src/components/Concepts/VariablesViz.module.css

    **pointerPulse (remove, matches @theme):**
    - src/components/Visualization/ArrayVisualization.module.css

    **borderPulse, iconPulse (remove, matches @theme):**
    - src/components/ErrorBoundary/ErrorBoundary.module.css

    **warningPulse (remove from both, matches @theme):**
    - src/components/Concepts/ObjectsBasicsViz.module.css
    - src/components/Concepts/ArraysBasicsViz.module.css

    **extractPulse (remove, matches @theme):**
    - src/components/Concepts/ObjectsBasicsViz.module.css

    **spreadOut, spreadIn (remove, matches @theme):**
    - src/components/Concepts/ArraysBasicsViz.module.css

    **CRITICAL: CSS Module scoping fix.** When removing local @keyframes, the animation property in that module references a scoped name. After removal, it must reference the global keyframe name. Two approaches:

    Option A (preferred): Since these modules use `animation: pulse 2s ease-in-out infinite` and the @theme keyframe is global `pulse`, the CSS Module's animation property already uses the unscoped name. When the local @keyframes is removed, CSS Modules won't scope it, and it will resolve to the global @theme keyframe. Test this with the first file.

    Option B (fallback): If animations break, use the `--animate-*` custom property:
    ```css
    /* Instead of: animation: pulse 2s ease-in-out infinite; */
    animation: var(--animate-pulse);
    ```

    Test approach with one module first (e.g., StateEvolutionViz.module.css) before doing all 15.
  </action>
  <verify>
    - `npm run build` passes with zero errors
    - `grep -r "@keyframes pulse" src/ --include="*.css" | grep -v "globals.css"` returns 0 matches (all removed from modules)
    - `grep -r "@keyframes fadeIn" src/ --include="*.css" | grep -v "globals.css"` returns 0 matches
    - `grep -r "@keyframes spin" src/ --include="*.css" | grep -v "globals.css"` returns 0 matches
    - `grep -r "@keyframes" src/ --include="*.module.css"` returns 0 matches (all keyframes moved to @theme)
    - `npm run lint` passes
    - Start dev server and verify animations work on at least: ErrorBoundary page, a concept viz page with pulse animation, EventLoop page with spin
  </verify>
  <done>
    - All duplicate @keyframes removed from CSS Modules
    - CSS Module animation properties reference global @theme keyframes
    - No @keyframes exist in any .module.css file
    - All animations work correctly (verified via dev server)
    - Build passes
  </done>
</task>

</tasks>

<verification>
- `npm run build` passes
- `grep -r "@keyframes" src/ --include="*.module.css"` returns 0 matches
- `grep "@keyframes" src/styles/globals.css | wc -l` returns 13 (all consolidated in @theme)
- `grep "\-\-breakpoint-" src/styles/globals.css` shows 3 custom breakpoints
- `grep "\-\-animate-" src/styles/globals.css` shows 13 animation tokens
- Dev server shows animations working on concept pages
</verification>

<success_criteria>
Custom breakpoints (360px, 400px, 480px) in @theme. All 13 unique keyframe animations consolidated in @theme with --animate-* tokens. Zero @keyframes in CSS Module files. All animations render correctly. Build passes with identical visual output.
</success_criteria>

<output>
After completion, create `.planning/phases/16-config-token-migration/16-06-SUMMARY.md`
</output>
