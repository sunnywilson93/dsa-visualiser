---
phase: 16-config-token-migration
plan: 02
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - src/styles/globals.css
  - "*.module.css (59+ files referencing --text-primary/secondary/muted/bright)"
autonomous: true

must_haves:
  truths:
    - "All color tokens are in the @theme block with --color-* namespace"
    - "Tailwind default colors are cleared with --color-*: initial"
    - "--text-primary/secondary/muted/bright renamed to --color-text-* everywhere"
    - "All var() references to old text color names updated across all CSS files"
    - "Non-namespaced tokens (gradients, glows, semantics) remain in :root @layer base"
    - "App builds successfully and all colors render correctly"
  artifacts:
    - path: "src/styles/globals.css"
      provides: "All ~130 color tokens in @theme --color-* namespace"
      contains: "--color-*: initial"
    - path: "src/styles/globals.css"
      provides: "Non-namespaced tokens in @layer base :root"
      contains: "--gradient-brand"
  key_links:
    - from: "*.module.css var(--color-text-primary)"
      to: "@theme --color-text-primary"
      via: "CSS custom property resolution"
      pattern: "var\\(--color-text-"
---

<objective>
Color Token Migration -- Move all color tokens from :root into @theme with --color-* namespace. Rename --text-* color tokens to --color-text-* to avoid collision with Tailwind v4's --text-* font-size namespace. Keep non-namespaced tokens (gradients, glows, semantic) in :root.

Purpose: Colors are the largest token group (~130 tokens). Migrating them to @theme generates Tailwind utility classes (bg-*, text-*, border-*) while preserving existing var() references. The --text-* rename is critical to avoid namespace collision.
Output: All color tokens in @theme, all var() references updated, non-namespaced tokens in :root.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-config-token-migration/16-RESEARCH.md
@.planning/phases/16-config-token-migration/16-01-SUMMARY.md
@src/styles/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate color tokens to @theme with namespace renaming</name>
  <files>src/styles/globals.css</files>
  <action>
    Move all color tokens from `:root` in `@layer base` into the `@theme` block. Apply these namespace rules:

    **Rename to --color-* namespace:**
    - `--bg-primary` -> `--color-bg-primary` (and all --bg-* tokens)
    - `--text-primary` -> `--color-text-primary` (CRITICAL: --text-* is font-size namespace in v4)
    - `--text-secondary` -> `--color-text-secondary`
    - `--text-muted` -> `--color-text-muted`
    - `--text-bright` -> `--color-text-bright`
    - `--accent-blue` -> `--color-accent-blue` (and all --accent-* tokens including opacity variants)
    - `--border-primary` -> `--color-border-primary`
    - `--border-secondary` -> `--color-border-secondary`
    - `--color-white` -> `--color-white` (already correct)
    - `--color-black` -> `--color-black` (already correct)
    - `--color-primary` -> `--color-brand-primary` (rename to avoid conflict with --color-primary being ambiguous)
    - `--color-secondary` -> `--color-brand-secondary`
    - `--color-primary-light` -> `--color-brand-light`
    - All `--color-primary-*` opacity variants -> `--color-brand-primary-*` (e.g., --color-brand-primary-5, --color-brand-primary-10, etc.)
    - All `--color-secondary-*` opacity variants -> `--color-brand-secondary-*`
    - `--gray-*` -> `--color-gray-*`
    - `--white-*` -> `--color-white-*` (opacity variants)
    - `--black-*` -> `--color-black-*` (opacity variants)
    - `--emerald-*` -> `--color-emerald-*`
    - `--teal-*` -> `--color-teal-*`
    - `--blue-*` -> `--color-blue-*`
    - `--sky-*` -> `--color-sky-*`
    - `--orange-*` (solid + opacity) -> `--color-orange-*`
    - `--red-*` -> `--color-red-*`
    - `--amber-*` -> `--color-amber-*`
    - `--neon-viz*` -> `--color-neon-viz*`

    **Clear Tailwind defaults:**
    - Add `--color-*: initial;` as the first line inside @theme's color section

    **Keep in :root (NOT in @theme) -- these stay in @layer base :root:**
    - All `--gradient-*` tokens (composite values referencing other vars)
    - All `--glow-brand*` tokens (composite box-shadow values)
    - All `--surface-*` and `--border-card*` tokens (semantic composite)
    - All `--card-*` tokens (semantic composite)
    - All `--theme-*` legacy aliases
    - `--gradient-neon`, `--glow-neon*`, `--neon-purple-light` legacy aliases
    - All `--difficulty-*` tokens (domain-specific)
    - All `--exec-*` tokens (domain-specific)
    - All `--stack-frame-*` tokens (domain-specific)

    **Update non-namespaced tokens in :root** that reference renamed vars:
    - `var(--color-primary)` -> `var(--color-brand-primary)` within :root
    - `var(--color-secondary)` -> `var(--color-brand-secondary)` within :root
    - `var(--color-primary-light)` -> `var(--color-brand-light)` within :root
    - And all other renamed references within the :root block itself
    - `var(--bg-page)` -> `var(--color-bg-page)` within :root
    - `var(--bg-page-secondary)` -> `var(--color-bg-page-secondary)` within :root

    Organize the @theme color section with clear comment headers: Background, Text, Core, Gray Scale, Accents (solid), Accents (opacity), White/Black opacity, Color scales (emerald, teal, blue, sky, orange, red, amber), Brand, Neon viz.
  </action>
  <verify>
    - `grep -c "\-\-color-" src/styles/globals.css | head -1` shows substantial color token count in file
    - `grep "@theme" src/styles/globals.css` shows @theme block exists
    - `grep "\-\-color-\*: initial" src/styles/globals.css` shows Tailwind defaults cleared
    - No `--text-primary` definition remains in @theme (only `--color-text-primary`)
    - Non-namespaced tokens (--gradient-brand, --glow-brand, etc.) still in :root block
  </verify>
  <done>All color tokens moved to @theme with --color-* namespace. Non-namespaced tokens remain in :root.</done>
</task>

<task type="auto">
  <name>Task 2: Update all var() references across CSS files</name>
  <files>All *.module.css files and src/styles/globals.css</files>
  <action>
    Search and replace ALL var() references across the entire codebase to match renamed tokens. This is a bulk rename operation.

    **Critical renames (high occurrence count):**
    - `var(--text-primary)` -> `var(--color-text-primary)` (225 occurrences across 59 files)
    - `var(--text-secondary)` -> `var(--color-text-secondary)`
    - `var(--text-muted)` -> `var(--color-text-muted)`
    - `var(--text-bright)` -> `var(--color-text-bright)`
    - `var(--bg-primary)` -> `var(--color-bg-primary)` (and all --bg-* variants)
    - `var(--accent-blue)` -> `var(--color-accent-blue)` (and all --accent-* variants including opacity)
    - `var(--border-primary)` -> `var(--color-border-primary)`
    - `var(--border-secondary)` -> `var(--color-border-secondary)`
    - `var(--color-primary)` -> `var(--color-brand-primary)` (careful: exact match only)
    - `var(--color-secondary)` -> `var(--color-brand-secondary)` (careful: exact match only)
    - `var(--color-primary-light)` -> `var(--color-brand-light)` (careful: exact match only)
    - `var(--color-primary-5)` through `var(--color-primary-50)` -> `var(--color-brand-primary-5)` through `var(--color-brand-primary-50)`
    - `var(--color-secondary-10)` through `var(--color-secondary-50)` -> `var(--color-brand-secondary-10)` through `var(--color-brand-secondary-50)`
    - `var(--gray-*)` -> `var(--color-gray-*)`
    - `var(--white-*)` -> `var(--color-white-*)`
    - `var(--black-*)` -> `var(--color-black-*)`
    - `var(--emerald-*)` -> `var(--color-emerald-*)`
    - `var(--teal-*)` -> `var(--color-teal-*)`
    - `var(--blue-*)` -> `var(--color-blue-*)`
    - `var(--sky-*)` -> `var(--color-sky-*)`
    - `var(--orange-*)` -> `var(--color-orange-*)`
    - `var(--red-*)` -> `var(--color-red-*)`
    - `var(--amber-*)` -> `var(--color-amber-*)`
    - `var(--neon-viz*)` -> `var(--color-neon-viz*)`
    - `var(--color-white)` and `var(--color-black)` stay as-is (already --color-* prefixed)

    Use `sed` or equivalent for bulk replacements. Process longest patterns first to avoid partial matches (e.g., `--color-primary-light` before `--color-primary`, `--accent-blue-20` before `--accent-blue`).

    IMPORTANT: Only rename var() references to COLOR tokens. Do NOT touch:
    - `var(--font-*)` (these are renamed in Plan 04)
    - `var(--space-*)` (renamed in Plan 03)
    - `var(--radius-*)`, `var(--shadow-*)` (Plan 05)
    - `var(--transition-*)`, `var(--leading-*)`, `var(--text-2xs)` etc. (non-color tokens)

    Also update any TSX/TS files that reference these CSS variable names in inline styles or string literals. Check with: `grep -r "\-\-text-primary\|\-\-bg-primary\|\-\-accent-blue" src/ --include="*.ts" --include="*.tsx"`
  </action>
  <verify>
    - `npm run build` passes with zero errors
    - `grep -r "var(--text-primary)" src/ --include="*.css"` returns 0 matches (all renamed)
    - `grep -r "var(--bg-primary)" src/ --include="*.css"` returns 0 matches (all renamed)
    - `grep -r "var(--accent-blue)" src/ --include="*.css"` returns 0 matches (all renamed to --color-accent-blue)
    - `grep -r "var(--color-text-primary)" src/ --include="*.css"` returns matches (renamed correctly)
    - `grep -r "var(--color-bg-primary)" src/ --include="*.css"` returns matches
    - `npm run lint` passes
  </verify>
  <done>
    - All color var() references updated to --color-* namespace across all CSS files
    - No orphaned references to old token names remain
    - Build passes, lint passes
    - All colors render correctly (same hex values, just different variable names)
  </done>
</task>

</tasks>

<verification>
- `npm run build` passes with zero errors
- `grep -rn "var(--text-primary\b" src/ --include="*.css"` returns 0 (all renamed to --color-text-primary)
- `grep -rn "var(--bg-primary\b" src/ --include="*.css"` returns 0 (all renamed to --color-bg-primary)
- `grep -c "\-\-color-\*: initial" src/styles/globals.css` returns 1 (defaults cleared)
- Non-namespaced tokens still in :root: `grep "\-\-gradient-brand" src/styles/globals.css` returns matches
</verification>

<success_criteria>
All ~130 color tokens live in @theme with --color-* namespace. Tailwind defaults are cleared. All 225+ var() references to renamed text color tokens are updated. Non-namespaced tokens (gradients, glows, semantics) remain in :root @layer base. Build passes with identical visual output.
</success_criteria>

<output>
After completion, create `.planning/phases/16-config-token-migration/16-02-SUMMARY.md`
</output>
