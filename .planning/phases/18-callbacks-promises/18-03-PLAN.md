---
phase: 18-callbacks-promises
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Concepts/PromisesCreationViz.tsx
  - src/components/Concepts/index.ts
  - src/app/concepts/[conceptId]/ConceptPageClient.tsx
autonomous: true

must_haves:
  truths:
    - "User can see Promise creation with new Promise constructor"
    - "User can observe executor function running synchronously"
    - "User can see resolve/reject triggering state change from pending"
    - "User can select beginner/intermediate/advanced difficulty levels"
  artifacts:
    - path: "src/components/Concepts/PromisesCreationViz.tsx"
      provides: "Promise creation and executor visualization"
      exports: ["PromisesCreationViz"]
  key_links:
    - from: "src/app/concepts/[conceptId]/ConceptPageClient.tsx"
      to: "PromisesCreationViz"
      via: "dynamic import in visualizations record"
      pattern: "promises-creation.*PromisesCreationViz"
---

<objective>
Create PromisesCreationViz component for teaching Promise constructor and executor mechanics.

Purpose: Learners understand that the executor runs synchronously, resolve/reject are just functions that trigger state transitions, and a Promise can only settle once.
Output: Self-contained Viz component following PromisesViz pattern with 3 difficulty levels.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-callbacks-promises/18-RESEARCH.md
@src/components/Concepts/PromisesViz.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PromisesCreationViz component</name>
  <files>src/components/Concepts/PromisesCreationViz.tsx</files>
  <action>
Create PromisesCreationViz.tsx following PromisesViz.tsx pattern:

1. Add 'use client' directive at top
2. Define interfaces:
   - PromiseState: { id: string, label: string, state: 'pending'|'fulfilled'|'rejected', value?: string, reason?: string }
   - Step: { id: number, phase: string, description: string, highlightLines: number[], promises: PromiseState[], executorPhase: 'not-started'|'running'|'complete', resolveRejectCalled: 'none'|'resolve'|'reject', output: string[] }
   - Example: id, title, code (string[]), steps (Step[]), insight

3. Define levelInfo with standard colors

4. Create examples for 3 levels:
   - Beginner (2 examples):
     * "Sync Executor" - new Promise with immediate resolve(), show executor runs sync
     * "Async Executor" - new Promise with setTimeout + resolve(), show async settlement
   - Intermediate (2 examples):
     * "Resolve vs Reject" - same promise with success/failure branches
     * "Multiple Resolve Calls" - show only first resolve() matters
   - Advanced (2 examples):
     * "Executor Throws" - throw inside executor = automatic reject
     * "Thenable Resolution" - resolve() with another promise

5. Unique visualization elements:
   - Executor phase indicator ("Not Started" -> "Running" -> "Complete")
   - resolve/reject function highlight (which one was called)
   - Promise state card (copy from PromisesViz with animations)
   - "Synchronous!" badge when executor is running during sync phase

6. Render structure:
   - Level/example selectors
   - Main visualization:
     * "Executor Function" neon box:
       - Phase badge (running/complete)
       - "Runs Synchronously!" warning when in sync phase
       - resolve/reject buttons visualization (not clickable, just showing which called)
     * "Promise State" card (from PromisesViz):
       - Large state label (PENDING/FULFILLED/REJECTED)
       - Value or reason display
       - Color-coded border glow
   - Code panel with highlightLines
   - Output panel
   - Step description and controls
   - Key Insight

Use PromisesViz animation patterns for promise state transitions.
Use Tailwind for new elements, matching project conventions.
  </action>
  <verify>
File exists, exports PromisesCreationViz, has executor phase and promise state visualization.
Run: `grep -c "executorPhase\|resolveRejectCalled\|pending\|fulfilled\|rejected" src/components/Concepts/PromisesCreationViz.tsx` returns 5+
  </verify>
  <done>PromisesCreationViz component shows executor running synchronously and state transitions</done>
</task>

<task type="auto">
  <name>Task 2: Register component in index and ConceptPageClient</name>
  <files>
    src/components/Concepts/index.ts
    src/app/concepts/[conceptId]/ConceptPageClient.tsx
  </files>
  <action>
1. In src/components/Concepts/index.ts, add export:
   ```typescript
   export { PromisesCreationViz } from './PromisesCreationViz'
   ```

2. In src/app/concepts/[conceptId]/ConceptPageClient.tsx:
   - Find the visualizations Record
   - Update/add entry for promises-creation (around line 63):
   ```typescript
   'promises-creation': dynamic(() => import('@/components/Concepts/PromisesCreationViz').then(m => m.PromisesCreationViz)),
   ```
   - Note: This may already point to PromisesViz - REPLACE it with PromisesCreationViz
  </action>
  <verify>
Run: `grep "PromisesCreationViz" src/components/Concepts/index.ts` returns match
Run: `grep "promises-creation" src/app/concepts/[conceptId]/ConceptPageClient.tsx | grep PromisesCreationViz` returns match
  </verify>
  <done>Component is exported and registered for dynamic loading</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` completes without errors
2. Component renders: Navigate to /concepts/promises-creation
3. Executor phase shows correctly: "Running" during sync execution
4. State transitions animate: pending -> fulfilled with smooth animation
</verification>

<success_criteria>
- PromisesCreationViz shows new Promise() constructor clearly
- Executor running synchronously is visually emphasized
- resolve/reject call is highlighted when it happens
- Promise state card animates on transition
- 3 difficulty levels with progressive complexity
</success_criteria>

<output>
After completion, create `.planning/phases/18-callbacks-promises/18-03-SUMMARY.md`
</output>
