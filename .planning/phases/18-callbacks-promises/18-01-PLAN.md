---
phase: 18-callbacks-promises
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Concepts/CallbacksBasicsViz.tsx
  - src/components/Concepts/CallbackHellViz.tsx
  - src/components/Concepts/index.ts
  - src/app/concepts/[conceptId]/ConceptPageClient.tsx
autonomous: true

must_haves:
  truths:
    - "User can step through callback function passing and see when callbacks are registered vs invoked"
    - "User can visualize callback hell pyramid with nesting depth indicator"
    - "User can select beginner/intermediate/advanced difficulty levels"
    - "Code panel highlights current line synced with visualization step"
  artifacts:
    - path: "src/components/Concepts/CallbacksBasicsViz.tsx"
      provides: "Callback basics step-through visualization"
      exports: ["CallbacksBasicsViz"]
    - path: "src/components/Concepts/CallbackHellViz.tsx"
      provides: "Callback hell pyramid visualization"
      exports: ["CallbackHellViz"]
  key_links:
    - from: "src/app/concepts/[conceptId]/ConceptPageClient.tsx"
      to: "CallbacksBasicsViz, CallbackHellViz"
      via: "dynamic import in visualizations record"
      pattern: "callbacks-basics.*CallbacksBasicsViz|callback-hell.*CallbackHellViz"
---

<objective>
Create CallbacksBasicsViz and CallbackHellViz components for teaching callback fundamentals.

Purpose: Learners understand how callbacks work - when they're registered vs. invoked, and why deeply nested callbacks become unreadable.
Output: Two self-contained Viz components following EventLoopViz pattern with 3 difficulty levels each.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-callbacks-promises/18-RESEARCH.md
@src/components/Concepts/EventLoopViz.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CallbacksBasicsViz component</name>
  <files>src/components/Concepts/CallbacksBasicsViz.tsx</files>
  <action>
Create CallbacksBasicsViz.tsx following EventLoopViz.tsx pattern exactly:

1. Add 'use client' directive at top
2. Define interfaces:
   - Step: description, codeLine, executingFunction (string|null), registeredCallbacks ({name, status: 'waiting'|'invoked'}[]), output, phase ('sync'|'registering'|'invoking')
   - Example: id, title, code (string[]), steps (Step[]), insight
   - Level: 'beginner' | 'intermediate' | 'advanced'

3. Define levelInfo with colors (beginner: #10b981, intermediate: #f59e0b, advanced: #ef4444)

4. Create examples Record with 3 levels:
   - Beginner (2 examples):
     * "Simple Callback" - setTimeout with callback, show registration then invocation
     * "Callback with Data" - array.forEach showing callback invoked per element
   - Intermediate (2 examples):
     * "Nested Callbacks" - callback inside callback, show order of registration/invocation
     * "Callbacks with Return" - array.map showing callback return values
   - Advanced (2 examples):
     * "Event Handlers" - addEventListener showing persistent callback registration
     * "Error Callbacks" - try/catch pattern with error callback

5. Component structure (copy from EventLoopViz):
   - useState for level, exampleIndex, stepIndex
   - useRef for lineRefs (code line scrolling)
   - useEffect for auto-scroll to highlighted line
   - handleLevelChange, handleExampleChange, handleNext, handlePrev, handleReset

6. Render structure:
   - Level selector (pill buttons with colored dots)
   - Example selector (tabs)
   - Main visualization grid:
     * "Current Function" neon box showing executingFunction
     * "Registered Callbacks" neon box with AnimatePresence list
   - Code panel with line highlighting
   - Output panel
   - Step description with AnimatePresence
   - Prev/Next/Reset controls
   - Key Insight section

Use Tailwind inline classes matching EventLoopViz patterns (var(--spacing-*), var(--color-*)).
Use Framer Motion for all animations (AnimatePresence mode="popLayout", motion.div with layout).
  </action>
  <verify>
File exists, exports CallbacksBasicsViz, has 3 difficulty levels with examples, uses 'use client' directive.
Run: `grep -c "beginner\|intermediate\|advanced" src/components/Concepts/CallbacksBasicsViz.tsx` returns 3+
  </verify>
  <done>CallbacksBasicsViz component renders with level/example selectors, step-through controls, and callback visualization</done>
</task>

<task type="auto">
  <name>Task 2: Create CallbackHellViz component</name>
  <files>src/components/Concepts/CallbackHellViz.tsx</files>
  <action>
Create CallbackHellViz.tsx following EventLoopViz.tsx pattern:

1. Add 'use client' directive at top
2. Define interfaces:
   - Step: description, highlightLines (number[]), nestingDepth (number), readabilityIssues (string[]), pyramidLevels ({level, code, indent}[]), output, phase ('normal'|'nested'|'pyramid'|'refactored')
   - Example: id, title, code (string[]), steps (Step[]), insight

3. Create examples for 3 levels:
   - Beginner (2 examples):
     * "First Nesting" - 2 levels deep, show first readability issue
     * "Growing Pyramid" - 3 levels, show indent accumulation
   - Intermediate (2 examples):
     * "API Sequence" - fetch().then() chain showing 4 levels
     * "File Operations" - fs.readFile nested callbacks
   - Advanced (2 examples):
     * "Full Pyramid of Doom" - 5+ levels with error handling
     * "Before/After" - same logic with callbacks vs promises

4. Unique visualization elements:
   - "Nesting Depth" indicator (1, 2, 3... with color degradation)
   - "Readability Score" meter (100% down to 20% as depth increases)
   - Visual pyramid showing indentation levels with gradient colors
   - Issues list showing specific readability problems

5. Render structure:
   - Level/example selectors
   - Main visualization:
     * Nesting depth badge (large number with color)
     * Readability score bar (green to red gradient)
     * Pyramid visualization (stacked indented blocks)
     * Issues panel (list of problems at current depth)
   - Code panel with highlightLines array support
   - Step description and controls
   - Key Insight

Copy animation patterns from EventLoopViz (AnimatePresence, motion.div).
  </action>
  <verify>
File exists, exports CallbackHellViz, has nesting depth and readability visualizations.
Run: `grep -c "nestingDepth\|readabilityScore\|pyramidLevels" src/components/Concepts/CallbackHellViz.tsx` returns 3+
  </verify>
  <done>CallbackHellViz component shows pyramid visualization with depth indicator and readability degradation</done>
</task>

<task type="auto">
  <name>Task 3: Register components in index and ConceptPageClient</name>
  <files>
    src/components/Concepts/index.ts
    src/app/concepts/[conceptId]/ConceptPageClient.tsx
  </files>
  <action>
1. In src/components/Concepts/index.ts, add exports:
   ```typescript
   export { CallbacksBasicsViz } from './CallbacksBasicsViz'
   export { CallbackHellViz } from './CallbackHellViz'
   ```

2. In src/app/concepts/[conceptId]/ConceptPageClient.tsx:
   - Find the visualizations Record (around line 16)
   - Add entries in the Phase 2: Async Foundation section (around line 59-69):
   ```typescript
   'callbacks-fundamentals': dynamic(() => import('@/components/Concepts/CallbacksBasicsViz').then(m => m.CallbacksBasicsViz)),
   'callback-hell': dynamic(() => import('@/components/Concepts/CallbackHellViz').then(m => m.CallbackHellViz)),
   ```
   - Note: 'callbacks-fundamentals' may already point to AsyncPatternsViz - REPLACE it with CallbacksBasicsViz
   - Note: 'callback-hell' may already point to AsyncPatternsViz - REPLACE it with CallbackHellViz
  </action>
  <verify>
Run: `grep -c "CallbacksBasicsViz\|CallbackHellViz" src/components/Concepts/index.ts` returns 2
Run: `grep "callbacks-fundamentals\|callback-hell" src/app/concepts/[conceptId]/ConceptPageClient.tsx | grep -v AsyncPatternsViz` returns matches
  </verify>
  <done>Both components are exported and registered for dynamic loading on their concept pages</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` completes without errors
2. Components render: Navigate to /concepts/callbacks-fundamentals and /concepts/callback-hell
3. Step controls work: Can step forward/back through visualization
4. Level switching works: All 3 levels show different examples
</verification>

<success_criteria>
- CallbacksBasicsViz shows callback registration vs invocation timing
- CallbackHellViz shows pyramid depth and readability degradation
- Both have 3 difficulty levels with multiple examples
- Code highlighting syncs with steps
- Key Insight displays for each example
</success_criteria>

<output>
After completion, create `.planning/phases/18-callbacks-promises/18-01-SUMMARY.md`
</output>
