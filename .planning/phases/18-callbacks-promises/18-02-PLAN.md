---
phase: 18-callbacks-promises
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Concepts/ErrorFirstCallbacksViz.tsx
  - src/components/Concepts/index.ts
  - src/app/concepts/[conceptId]/ConceptPageClient.tsx
autonomous: true

must_haves:
  truths:
    - "User can step through error-first callback pattern (err, data) signature"
    - "User can see error path vs success path branch visually"
    - "User can trace error propagation through callback chain"
    - "User can select beginner/intermediate/advanced difficulty levels"
  artifacts:
    - path: "src/components/Concepts/ErrorFirstCallbacksViz.tsx"
      provides: "Error-first callback pattern visualization"
      exports: ["ErrorFirstCallbacksViz"]
  key_links:
    - from: "src/app/concepts/[conceptId]/ConceptPageClient.tsx"
      to: "ErrorFirstCallbacksViz"
      via: "dynamic import in visualizations record"
      pattern: "error-first-callbacks.*ErrorFirstCallbacksViz"
---

<objective>
Create ErrorFirstCallbacksViz component for teaching Node.js error-first callback conventions.

Purpose: Learners understand the (err, data) pattern, why error is first, and how errors propagate through callback chains.
Output: Self-contained Viz component following EventLoopViz pattern with 3 difficulty levels.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-callbacks-promises/18-RESEARCH.md
@src/components/Concepts/EventLoopViz.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ErrorFirstCallbacksViz component</name>
  <files>src/components/Concepts/ErrorFirstCallbacksViz.tsx</files>
  <action>
Create ErrorFirstCallbacksViz.tsx following EventLoopViz.tsx pattern:

1. Add 'use client' directive at top
2. Define interfaces:
   - Step: description, highlightLines (number[]), errorPath ({active: boolean, errorValue?: string}), successPath ({active: boolean, value?: string}), callbackChain ({name: string, received: 'error'|'data'|'pending'}[]), output, phase ('calling'|'error-check'|'success'|'error')
   - Example: id, title, code (string[]), steps (Step[]), insight

3. Define levelInfo with standard colors

4. Create examples for 3 levels:
   - Beginner (2 examples):
     * "Basic Error Check" - fs.readFile with if(err) check, show success path
     * "Error Handling" - same code but file doesn't exist, show error path
   - Intermediate (2 examples):
     * "Chained Callbacks" - readFile -> parseJSON -> callback chain
     * "Error Propagation" - error in middle of chain, show it bubbles up
   - Advanced (2 examples):
     * "Try-Catch in Async" - showing try-catch doesn't work with callbacks
     * "Error-First Convention" - why err comes first (partial application pattern)

5. Unique visualization elements:
   - Error/Success path fork diagram (two branches diverging)
   - Current path indicator (red for error, green for success)
   - Callback chain visualization with status badges
   - Error object display (when error occurs)

6. Render structure:
   - Level/example selectors (copy from EventLoopViz)
   - Main visualization grid:
     * "Path Taken" neon box with fork visualization:
       - Left branch: Error Path (red gradient border)
       - Right branch: Success Path (green gradient border)
       - Active path highlighted, inactive dimmed
     * "Callback Chain" neon box showing each callback with status
     * "Error Object" panel (only visible when error active)
   - Code panel with highlightLines array support
   - Output panel
   - Step description and controls
   - Key Insight

Color scheme:
- Error path: var(--color-red-500), var(--color-red-400)
- Success path: var(--color-emerald-500), var(--color-emerald-400)
- Pending: var(--color-gray-500)

Use AnimatePresence for path switching animations.
  </action>
  <verify>
File exists, exports ErrorFirstCallbacksViz, has error/success path visualization.
Run: `grep -c "errorPath\|successPath\|error-check" src/components/Concepts/ErrorFirstCallbacksViz.tsx` returns 3+
  </verify>
  <done>ErrorFirstCallbacksViz component shows error-first pattern with branching paths</done>
</task>

<task type="auto">
  <name>Task 2: Register component in index and ConceptPageClient</name>
  <files>
    src/components/Concepts/index.ts
    src/app/concepts/[conceptId]/ConceptPageClient.tsx
  </files>
  <action>
1. In src/components/Concepts/index.ts, add export:
   ```typescript
   export { ErrorFirstCallbacksViz } from './ErrorFirstCallbacksViz'
   ```

2. In src/app/concepts/[conceptId]/ConceptPageClient.tsx:
   - Find the visualizations Record
   - Update/add entry for error-first-callbacks (around line 61):
   ```typescript
   'error-first-callbacks': dynamic(() => import('@/components/Concepts/ErrorFirstCallbacksViz').then(m => m.ErrorFirstCallbacksViz)),
   ```
   - Note: This may already point to AsyncPatternsViz - REPLACE it with ErrorFirstCallbacksViz
  </action>
  <verify>
Run: `grep "ErrorFirstCallbacksViz" src/components/Concepts/index.ts` returns match
Run: `grep "error-first-callbacks" src/app/concepts/[conceptId]/ConceptPageClient.tsx | grep ErrorFirstCallbacksViz` returns match
  </verify>
  <done>Component is exported and registered for dynamic loading</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` completes without errors
2. Component renders: Navigate to /concepts/error-first-callbacks
3. Path visualization works: Error path shows red, success path shows green
4. Step controls work: Can step through error propagation
</verification>

<success_criteria>
- ErrorFirstCallbacksViz shows (err, data) signature pattern
- Error path and success path visually distinct
- Error propagation through chain is traceable
- 3 difficulty levels with progressive complexity
- Key Insight displays for each example
</success_criteria>

<output>
After completion, create `.planning/phases/18-callbacks-promises/18-02-SUMMARY.md`
</output>
