---
phase: 22-foundation-audit
plan: 03
type: execute
wave: 2
depends_on: [22-01, 22-02]
files_modified:
  - src/constants/index.ts
autonomous: true

must_haves:
  truths:
    - "Barrel export src/constants/index.ts re-exports all types and constants from child modules"
    - "Barrel imports actually resolve and values are accessible at runtime"
    - "CSS var references in modules correspond to existing @theme definitions"
  artifacts:
    - path: "src/constants/index.ts"
      provides: "Barrel export for all shared constants"
      exports: ["Level", "LevelConfig", "LEVEL_INFO", "Phase", "getPhaseColor", "PHASE_COLORS", "VariableStatus", "getStatusColor", "STATUS_COLORS"]
  key_links:
    - from: "src/constants/index.ts"
      to: "src/constants/levelInfo.ts"
      via: "re-export"
      pattern: "export .* from './levelInfo'"
    - from: "src/constants/index.ts"
      to: "src/constants/phaseColors.ts"
      via: "re-export"
      pattern: "export .* from './phaseColors'"
    - from: "src/constants/index.ts"
      to: "src/constants/statusColors.ts"
      via: "re-export"
      pattern: "export .* from './statusColors'"
    - from: "src/constants/*.ts"
      to: "src/styles/globals.css"
      via: "CSS var validation"
      pattern: "var\\(--color-[a-z]+-[0-9]+\\)"
---

<objective>
Create barrel export for constants, validate CSS var references, and verify build passes.

Purpose: Complete the shared infrastructure by enabling clean imports (`import { LEVEL_INFO } from '@/constants'`), validate TypeScript type safety for token references (INFRA-04), and ensure full build passes.

Output: New src/constants/index.ts with all exports, validated CSS var references, passing build.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-foundation-audit/22-RESEARCH.md
@e2e/visual-regression.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create barrel export for constants</name>
  <files>src/constants/index.ts</files>
  <action>
Create src/constants/index.ts that re-exports all types and constants from child modules:

```typescript
/**
 * Shared constants for visualization components.
 *
 * Usage:
 *   import { LEVEL_INFO, getPhaseColor, getStatusColor } from '@/constants'
 *
 * All color values reference @theme CSS custom properties defined in globals.css.
 */

// Level/difficulty information
export { LEVEL_INFO } from './levelInfo'
export type { Level, LevelConfig } from './levelInfo'

// Execution phase colors
export { PHASE_COLORS, getPhaseColor } from './phaseColors'
export type { Phase } from './phaseColors'

// Variable state colors
export { STATUS_COLORS, STATUS_BG_COLORS, getStatusColor } from './statusColors'
export type { VariableStatus } from './statusColors'
```

This enables:
- `import { LEVEL_INFO } from '@/constants'` - convenient barrel import
- `import { Level } from '@/constants/levelInfo'` - direct module import still works
- Type exports are separate from value exports for tree-shaking
  </action>
  <verify>
Run: `npx tsc --noEmit src/constants/index.ts`
Should complete with no errors.

Verify export count:
`grep "export" src/constants/index.ts | wc -l`
Should return 6 (3 value exports + 3 type exports).

Verify re-exports actually resolve (values are accessible):
```bash
# Create test file that imports from barrel and accesses values
cat > /tmp/barrel-test.ts << 'EOF'
import { LEVEL_INFO, PHASE_COLORS, STATUS_COLORS, getPhaseColor, getStatusColor } from './src/constants'
// Verify values exist
const beginner = LEVEL_INFO.beginner
const creation = PHASE_COLORS.Creation
const hoisted = STATUS_COLORS.hoisted
const phase = getPhaseColor('Creation')
const status = getStatusColor('hoisted')
console.log(beginner, creation, hoisted, phase, status)
EOF
npx tsc --noEmit --esModuleInterop --moduleResolution node /tmp/barrel-test.ts && echo "Barrel imports resolve correctly"
rm /tmp/barrel-test.ts
```
  </verify>
  <done>
index.ts barrel exports all types and constants from levelInfo, phaseColors, and statusColors modules. Imports from '@/constants' resolve correctly and values are accessible.
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate CSS var references match @theme definitions (INFRA-04)</name>
  <files>src/constants/levelInfo.ts, src/constants/phaseColors.ts, src/constants/statusColors.ts</files>
  <action>
Validate that all CSS var references in the constants modules correspond to actual definitions in globals.css @theme block. This ensures TypeScript type safety has compile-time validation - if a var doesn't exist in @theme, the visual will break at runtime.

1. Extract all CSS var references from constants modules:
```bash
grep -ohE "var\(--color-[a-z]+-[0-9]+\)" src/constants/*.ts | sort | uniq > /tmp/used-vars.txt
cat /tmp/used-vars.txt
```

2. Extract all color definitions from @theme in globals.css:
```bash
grep -ohE "--color-[a-z]+-[0-9]+:" src/styles/globals.css | sed 's/:$//' | sort | uniq > /tmp/defined-vars.txt
```

3. Compare - every used var MUST be defined:
```bash
# Convert used vars to just the variable name (strip var() wrapper)
sed 's/var(//; s/)$//' /tmp/used-vars.txt > /tmp/used-names.txt

# Find any vars used but not defined
comm -23 /tmp/used-names.txt /tmp/defined-vars.txt
```

4. If any vars are missing from @theme, either:
   - Add them to globals.css (if they should exist)
   - Fix the reference in the constants module (if typo)

5. Document the validation results showing all vars are properly linked.

Clean up:
```bash
rm /tmp/used-vars.txt /tmp/defined-vars.txt /tmp/used-names.txt
```
  </action>
  <verify>
Run the comparison command:
```bash
grep -ohE "var\(--color-[a-z]+-[0-9]+\)" src/constants/*.ts | sed 's/var(//; s/)$//' | sort | uniq | while read var; do
  grep -q "$var:" src/styles/globals.css || echo "MISSING: $var"
done
```
Should produce no output (all vars exist in @theme).
  </verify>
  <done>
All CSS var references in constants modules validated against @theme definitions. TypeScript compile-time safety confirmed - no dangling var references.
  </done>
</task>

<task type="auto">
  <name>Task 3: Validate complete build passes</name>
  <files>src/constants/index.ts</files>
  <action>
Run full build and lint to ensure Phase 22 changes don't break anything:

```bash
npm run lint
npm run build
```

Both commands should complete with zero errors. Document any warnings that appear but don't block the build.

Also verify the constants path alias works:
```bash
# Test that TypeScript resolves @/constants
echo "import { LEVEL_INFO } from '@/constants'" > /tmp/test-import.ts
npx tsc --noEmit --baseUrl . --paths '{"@/*": ["src/*"]}' /tmp/test-import.ts 2>&1 || echo "Import test result above"
rm /tmp/test-import.ts
```
  </action>
  <verify>
`npm run build` exits with code 0.
`npm run lint` exits with code 0 (or only pre-existing warnings).
  </verify>
  <done>
Full build and lint pass. Phase 22 foundation complete and ready for Phase 23 migration.
  </done>
</task>

</tasks>

<verification>
1. Run `npm run build` - should pass with no errors
2. Run `npm run lint` - should pass with no new errors
3. Verify barrel export: `grep "export" src/constants/index.ts` shows all re-exports
4. Verify barrel imports resolve: test file can import and access values from '@/constants'
5. Verify CSS var references: all vars in constants modules exist in globals.css @theme
</verification>

<success_criteria>
1. src/constants/index.ts exists with complete barrel exports
2. Barrel imports resolve correctly (values accessible, not just types)
3. All CSS var references validated against @theme definitions (INFRA-04)
4. Full build passes with zero errors
5. Lint passes with no new warnings
</success_criteria>

<output>
After completion, create `.planning/phases/22-foundation-audit/22-03-SUMMARY.md`
</output>
