---
phase: 22-foundation-audit
plan: 03
type: execute
wave: 2
depends_on: [22-01, 22-02]
files_modified:
  - src/constants/index.ts
autonomous: true

must_haves:
  truths:
    - "Barrel export src/constants/index.ts re-exports all types and constants from child modules"
    - "Barrel imports actually resolve and values are accessible at runtime"
    - "CSS var references in modules correspond to existing @theme definitions"
  artifacts:
    - path: "src/constants/index.ts"
      provides: "Barrel export for all shared constants"
      exports: ["Level", "LevelConfig", "LEVEL_INFO", "Phase", "getPhaseColor", "PHASE_COLORS", "VariableStatus", "getStatusColor", "STATUS_COLORS"]
  key_links:
    - from: "src/constants/index.ts"
      to: "src/constants/levelInfo.ts"
      via: "re-export"
      pattern: "export .* from './levelInfo'"
    - from: "src/constants/index.ts"
      to: "src/constants/phaseColors.ts"
      via: "re-export"
      pattern: "export .* from './phaseColors'"
    - from: "src/constants/index.ts"
      to: "src/constants/statusColors.ts"
      via: "re-export"
      pattern: "export .* from './statusColors'"
    - from: "src/constants/*.ts"
      to: "src/styles/globals.css"
      via: "CSS var validation"
      pattern: "var\\(--color-[a-z]+-[0-9]+\\)"
---

<objective>
Create barrel export for constants, validate CSS var references, and verify build passes.

Purpose: Complete the shared infrastructure by enabling clean imports (`import { LEVEL_INFO } from '@/constants'`), validate TypeScript type safety for token references (INFRA-04), and ensure full build passes.

Output: New src/constants/index.ts with all exports, validated CSS var references, passing build.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-foundation-audit/22-RESEARCH.md
@e2e/visual-regression.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create barrel export for constants</name>
  <files>src/constants/index.ts</files>
  <action>
Create src/constants/index.ts that re-exports all types and constants from child modules:

```typescript
/**
 * Shared constants for visualization components.
 *
 * Usage:
 *   import { LEVEL_INFO, getPhaseColor, getStatusColor } from '@/constants'
 *
 * All color values reference @theme CSS custom properties defined in globals.css.
 */

// Level/difficulty information
export { LEVEL_INFO } from './levelInfo'
export type { Level, LevelConfig } from './levelInfo'

// Execution phase colors
export { PHASE_COLORS, getPhaseColor } from './phaseColors'
export type { Phase } from './phaseColors'

// Variable state colors
export { STATUS_COLORS, STATUS_BG_COLORS, getStatusColor } from './statusColors'
export type { VariableStatus } from './statusColors'
```

This enables:
- `import { LEVEL_INFO } from '@/constants'` - convenient barrel import
- `import { Level } from '@/constants/levelInfo'` - direct module import still works
- Type exports are separate from value exports for tree-shaking
  </action>
  <verify>
Run: `npx tsc --noEmit src/constants/index.ts`
Should complete with no errors.

Verify export count:
`grep "export" src/constants/index.ts | wc -l`
Should return 6 (3 value exports + 3 type exports).

Verify re-exports actually resolve (values are accessible):
```bash
# Verify barrel exports compile correctly by testing index.ts directly
npx tsc --noEmit src/constants/index.ts && echo "Barrel exports compile correctly"

# Then verify barrel imports work with path alias via build
npm run build 2>&1 | grep -i "error" || echo "Build passed - barrel imports resolve"
```
  </verify>
  <done>
index.ts barrel exports all types and constants from levelInfo, phaseColors, and statusColors modules. Imports from '@/constants' resolve correctly and values are accessible.
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate constants-specific CSS var references exist in @theme (INFRA-04)</name>
  <files>src/constants/levelInfo.ts, src/constants/phaseColors.ts, src/constants/statusColors.ts</files>
  <action>
Validate that CSS var references used in the newly created constants modules exist in @theme. Plan 22-01 already added the opacity variants to @theme - this task validates the specific vars used by the constants modules.

Run validation:
```bash
grep -ohE "var\(--color-[a-z]+-[0-9]+\)" src/constants/*.ts | sed 's/var(//; s/)$//' | sort | uniq | while read var; do
  grep -q "$var:" src/styles/globals.css || echo "MISSING: $var"
done
```

If any vars are reported MISSING:
- Check if it's a typo in the constants module
- If legitimate var, verify Plan 22-01 added it or add it now

This is a quick sanity check to catch any typos before proceeding.
  </action>
  <verify>
Run the validation command above - should produce no output (all vars exist).
  </verify>
  <done>
CSS var references in constants modules validated - no dangling references.
  </done>
</task>

<task type="auto">
  <name>Task 3: Validate complete build passes</name>
  <files>src/constants/index.ts</files>
  <action>
Run full build and lint to ensure Phase 22 changes don't break anything:

```bash
npm run lint
npm run build
```

Both commands should complete with zero errors. Document any warnings that appear but don't block the build.

Also verify the constants path alias works:
```bash
# Test that TypeScript resolves @/constants
echo "import { LEVEL_INFO } from '@/constants'" > /tmp/test-import.ts
npx tsc --noEmit --baseUrl . --paths '{"@/*": ["src/*"]}' /tmp/test-import.ts 2>&1 || echo "Import test result above"
rm /tmp/test-import.ts
```
  </action>
  <verify>
`npm run build` exits with code 0.
`npm run lint` exits with code 0 (or only pre-existing warnings).
  </verify>
  <done>
Full build and lint pass. Phase 22 foundation complete and ready for Phase 23 migration.
  </done>
</task>

</tasks>

<verification>
1. Run `npm run build` - should pass with no errors
2. Run `npm run lint` - should pass with no new errors
3. Verify barrel export: `grep "export" src/constants/index.ts` shows all re-exports
4. Verify barrel imports resolve: test file can import and access values from '@/constants'
5. Verify CSS var references: all vars in constants modules exist in globals.css @theme
</verification>

<success_criteria>
1. src/constants/index.ts exists with complete barrel exports
2. Barrel imports resolve correctly (values accessible, not just types)
3. All CSS var references validated against @theme definitions (INFRA-04)
4. Full build passes with zero errors
5. Lint passes with no new warnings
</success_criteria>

<output>
After completion, create `.planning/phases/22-foundation-audit/22-03-SUMMARY.md`
</output>
