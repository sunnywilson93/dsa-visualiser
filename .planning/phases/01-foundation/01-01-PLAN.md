---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/SharedViz/CodePanel.tsx
  - src/components/SharedViz/CodePanel.module.css
  - src/components/SharedViz/StepProgress.tsx
  - src/components/SharedViz/StepProgress.module.css
  - src/components/SharedViz/index.ts
autonomous: true

must_haves:
  truths:
    - "CodePanel renders an array of code lines with line numbers"
    - "CodePanel highlights a specific line when highlightedLine prop is provided"
    - "CodePanel auto-scrolls to bring highlighted line into view"
    - "StepProgress displays current step and total steps in 'Step X/Y' format"
    - "StepProgress shows step description with animated transitions"
  artifacts:
    - path: "src/components/SharedViz/CodePanel.tsx"
      provides: "Reusable code display with line highlighting"
      exports: ["CodePanel", "CodePanelProps"]
    - path: "src/components/SharedViz/StepProgress.tsx"
      provides: "Step badge and description display"
      exports: ["StepProgress", "StepProgressProps"]
    - path: "src/components/SharedViz/index.ts"
      provides: "Barrel export for SharedViz components"
      exports: ["CodePanel", "StepProgress"]
  key_links:
    - from: "CodePanel.tsx"
      to: "scrollIntoView"
      via: "useEffect when highlightedLine changes"
      pattern: "scrollIntoView.*nearest"
    - from: "StepProgress.tsx"
      to: "framer-motion"
      via: "AnimatePresence for description animation"
      pattern: "AnimatePresence"
---

<objective>
Create CodePanel and StepProgress components - the display-focused foundation for step-through visualizations.

Purpose: These components provide consistent code display with line highlighting and step progress indication across all concept visualizations. They follow the EventLoopViz gold standard styling.

Output: Two React components with CSS modules, exported via barrel file, matching EventLoopViz visual language.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
@src/components/Concepts/EventLoopViz.tsx
@src/components/Concepts/EventLoopViz.module.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CodePanel component</name>
  <files>
    src/components/SharedViz/CodePanel.tsx
    src/components/SharedViz/CodePanel.module.css
  </files>
  <action>
Create the CodePanel component following EventLoopViz patterns:

**CodePanel.tsx:**
- Accept props: `code: string[]`, `highlightedLine?: number` (-1 or undefined = no highlight), `showLineNumbers?: boolean` (default true), `maxHeight?: string` (default '160px'), `title?: string` (default 'Code'), `rightElement?: React.ReactNode` (optional header badge)
- Export both component and props interface
- Create refs array for line elements: `useRef<(HTMLDivElement | null)[]>([])`
- useEffect to scroll highlighted line into view when highlightedLine changes, using `scrollIntoView({ behavior: 'smooth', block: 'nearest' })`
- Render panel with header showing title (and optional rightElement), then `<pre>` containing line divs
- Each line div has line number span + code span, applies `activeLine` class when highlighted
- Handle empty lines: render a single space character to maintain line height

**CodePanel.module.css:**
- Define CSS variables with fallbacks matching EventLoopViz:
  - `--js-viz-surface: rgba(26, 26, 46, 1)`
  - `--js-viz-border: rgba(255, 255, 255, 0.1)`
  - `--js-viz-text: #e5e7eb`
  - `--js-viz-muted: #888`
- `.codePanel` - container with background, border, border-radius
- `.panelHeader` - flex header with title styling
- `.code` - pre element with overflow-y auto, custom maxHeight
- `.codeLine` - flex row for line number + code, padding
- `.activeLine` - highlighted background `rgba(102, 126, 234, 0.2)`, text color `#a5b4fc`
- `.lineNum` - muted color, fixed width, text-align right
- `.lineCode` - code text styling

Match EventLoopViz styling exactly - same spacing, colors, border radius.
  </action>
  <verify>
    - File exists: `ls src/components/SharedViz/CodePanel.tsx`
    - TypeScript compiles: `npx tsc --noEmit`
    - Component exports CodePanel and CodePanelProps
  </verify>
  <done>
    - CodePanel renders code array with line numbers
    - Highlighted line has distinct background color
    - Auto-scroll works when highlighted line changes
    - Styling matches EventLoopViz code panel
  </done>
</task>

<task type="auto">
  <name>Task 2: Create StepProgress component</name>
  <files>
    src/components/SharedViz/StepProgress.tsx
    src/components/SharedViz/StepProgress.module.css
  </files>
  <action>
Create the StepProgress component following EventLoopViz pattern:

**StepProgress.tsx:**
- Accept props: `current: number` (0-indexed), `total: number`, `description: string`, `animated?: boolean` (default true)
- Export both component and props interface
- Use framer-motion AnimatePresence with mode="wait" for animated description changes
- Display step badge: "Step {current + 1}/{total}" (convert 0-indexed to 1-indexed for display)
- Display description text after the badge
- Animate with initial `{ opacity: 0, y: 5 }`, animate `{ opacity: 1, y: 0 }`, exit `{ opacity: 0, y: -5 }`
- Key the motion.div on `current` to trigger animation on step change
- If `animated` is false, render static content without AnimatePresence

**StepProgress.module.css:**
- `.description` - container with appropriate spacing and text styling
- `.stepBadge` - pill styling matching EventLoopViz:
  - Background: `rgba(102, 126, 234, 0.1)`
  - Border: `1px solid rgba(102, 126, 234, 0.3)`
  - Border-radius: `var(--radius-full)` or `9999px`
  - Padding: small horizontal padding
  - Font-size: smaller than description text
  - Margin-right to separate from description
  </action>
  <verify>
    - File exists: `ls src/components/SharedViz/StepProgress.tsx`
    - TypeScript compiles: `npx tsc --noEmit`
    - Component exports StepProgress and StepProgressProps
  </verify>
  <done>
    - StepProgress shows "Step X/Y" badge with correct 1-indexed display
    - Description text animates on step change
    - Badge styling matches EventLoopViz pill style
  </done>
</task>

<task type="auto">
  <name>Task 3: Create barrel export and verify integration</name>
  <files>
    src/components/SharedViz/index.ts
  </files>
  <action>
Create the barrel export file:

**index.ts:**
```typescript
export { CodePanel } from './CodePanel'
export type { CodePanelProps } from './CodePanel'

export { StepProgress } from './StepProgress'
export type { StepProgressProps } from './StepProgress'
```

Verify the components work together by checking:
1. TypeScript compilation succeeds
2. Imports resolve correctly via the barrel

Do NOT create a test page or demo - that's not in scope. Just verify the exports work.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Barrel exports all components: `grep -E "export.*CodePanel|export.*StepProgress" src/components/SharedViz/index.ts`
  </verify>
  <done>
    - SharedViz/index.ts exports CodePanel, CodePanelProps, StepProgress, StepProgressProps
    - TypeScript resolves all imports without errors
  </done>
</task>

</tasks>

<verification>
1. `ls -la src/components/SharedViz/` shows all 5 files created
2. `npx tsc --noEmit` passes with no errors
3. `npm run lint` passes (or has only pre-existing warnings)
4. CSS variables follow EventLoopViz naming conventions
</verification>

<success_criteria>
- CodePanel component exists and renders code with line highlighting
- StepProgress component exists and shows animated step badge + description
- Both components use CSS Modules with EventLoopViz-matching styles
- Barrel export enables `import { CodePanel, StepProgress } from '@/components/SharedViz'`
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
