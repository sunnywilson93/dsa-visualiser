---
phase: 01-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/SharedViz/StepControls.tsx
  - src/components/SharedViz/StepControls.module.css
  - src/components/SharedViz/useAutoPlay.ts
  - src/components/SharedViz/index.ts
autonomous: true

must_haves:
  truths:
    - "StepControls provides Prev, Next, and Reset buttons"
    - "Prev button is disabled when at first step"
    - "Next button is disabled when at last step"
    - "Next button shows 'Done' label when at last step"
    - "Auto-play advances steps at configurable interval"
    - "Auto-play pauses when user clicks any step control"
  artifacts:
    - path: "src/components/SharedViz/StepControls.tsx"
      provides: "Step navigation buttons with disabled states"
      exports: ["StepControls", "StepControlsProps"]
    - path: "src/components/SharedViz/useAutoPlay.ts"
      provides: "Auto-play hook with speed control"
      exports: ["useAutoPlay", "UseAutoPlayOptions"]
    - path: "src/components/SharedViz/index.ts"
      provides: "Updated barrel export including new components"
      exports: ["StepControls", "useAutoPlay"]
  key_links:
    - from: "StepControls.tsx"
      to: "framer-motion"
      via: "motion.button for Next with whileHover/whileTap"
      pattern: "motion\\.button"
    - from: "useAutoPlay.ts"
      to: "setInterval cleanup"
      via: "useEffect return cleanup function"
      pattern: "return.*clearInterval"
---

<objective>
Create StepControls component and useAutoPlay hook - the interactive foundation for step-through visualizations.

Purpose: These components provide consistent navigation controls and auto-play functionality across all concept visualizations. StepControls handles manual stepping; useAutoPlay handles automatic progression with pause-on-interaction.

Output: One React component, one custom hook, with CSS module, all exported via updated barrel file.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
@src/components/Concepts/EventLoopViz.tsx
@src/components/Concepts/EventLoopViz.module.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StepControls component</name>
  <files>
    src/components/SharedViz/StepControls.tsx
    src/components/SharedViz/StepControls.module.css
  </files>
  <action>
Create the StepControls component following EventLoopViz patterns:

**StepControls.tsx:**
- Accept props interface:
  ```typescript
  interface StepControlsProps {
    onPrev: () => void
    onNext: () => void
    onReset: () => void
    canPrev: boolean
    canNext: boolean
    nextLabel?: string           // Default: 'Next', or 'Done' when !canNext
    isPlaying?: boolean          // For auto-play indicator
    onPlayPause?: () => void     // Toggle auto-play
    showPlayPause?: boolean      // Default: false
  }
  ```
- Export both component and props interface
- Three buttons in a flex container: Prev (secondary), Next (primary), Reset (secondary)
- Next button uses framer-motion for hover/tap animation: `whileHover={{ scale: 1.02 }}`, `whileTap={{ scale: 0.98 }}`
- Next button label: use `nextLabel` if provided, else 'Done' if `!canNext`, else 'Next'
- If `showPlayPause` is true, add play/pause button (use lucide-react Play/Pause icons)
- All buttons get `disabled` attribute based on their condition
- Clicking any control (Prev/Next/Reset) should call the handler AND pause auto-play if playing (caller handles via onPlayPause)

**StepControls.module.css:**
- `.controls` - flex container with gap, center alignment
- `.btnPrimary` - gradient background matching EventLoopViz:
  - `background: linear-gradient(135deg, #667eea, #764ba2)`
  - White text, medium padding, border-radius, cursor pointer
  - `:disabled` - 0.5 opacity, not-allowed cursor
- `.btnSecondary` - subtle background:
  - `background: rgba(255, 255, 255, 0.05)`
  - `border: 1px solid rgba(255, 255, 255, 0.1)`
  - Muted text color, smaller padding
  - `:hover:not(:disabled)` - slightly brighter background
  - `:disabled` - 0.5 opacity, not-allowed cursor
- `.playPauseBtn` - style for optional play/pause button if needed (can be secondary style)

Match EventLoopViz button styling exactly - same padding, colors, hover states.
  </action>
  <verify>
    - File exists: `ls src/components/SharedViz/StepControls.tsx`
    - TypeScript compiles: `npx tsc --noEmit`
    - Component exports StepControls and StepControlsProps
  </verify>
  <done>
    - StepControls renders Prev/Next/Reset buttons
    - Buttons disable correctly at boundaries
    - Next shows 'Done' when !canNext
    - Button styling matches EventLoopViz
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useAutoPlay hook</name>
  <files>
    src/components/SharedViz/useAutoPlay.ts
  </files>
  <action>
Create the useAutoPlay custom hook:

**useAutoPlay.ts:**
- Interface for options:
  ```typescript
  interface UseAutoPlayOptions {
    speed?: number              // Milliseconds between steps, default 1000
    onEnd?: () => void          // Called when reaching last step
  }
  ```
- Hook signature:
  ```typescript
  function useAutoPlay(
    totalSteps: number,
    currentStep: number,
    setStep: (step: number) => void,
    options?: UseAutoPlayOptions
  ): {
    isPlaying: boolean
    play: () => void
    pause: () => void
    toggle: () => void
    speed: number
    setSpeed: (ms: number) => void
  }
  ```
- Internal state: `isPlaying` (boolean), `speed` (number, default from options or 1000)
- Use `useRef` to store current step to avoid stale closure in interval callback
- useEffect to sync ref with currentStep prop
- useEffect for the interval:
  - Only run if `isPlaying` is true
  - Create interval that:
    - Reads current step from ref
    - If at last step, call `onEnd` if provided, then `pause()`
    - Otherwise, call `setStep(currentStepRef.current + 1)`
  - Return cleanup: `clearInterval(interval)`
  - Dependencies: `[isPlaying, speed, totalSteps, setStep, options?.onEnd]`
- Expose `play`, `pause`, `toggle` functions to control isPlaying state
- Expose `speed` and `setSpeed` for configurable speed

IMPORTANT: Avoid stale closure - use refs for values that change frequently but shouldn't restart the interval.
  </action>
  <verify>
    - File exists: `ls src/components/SharedViz/useAutoPlay.ts`
    - TypeScript compiles: `npx tsc --noEmit`
    - Hook exports useAutoPlay and UseAutoPlayOptions
  </verify>
  <done>
    - useAutoPlay hook manages isPlaying state
    - Auto-advances step at configured speed
    - Pauses automatically at last step
    - No stale closure issues (uses refs correctly)
  </done>
</task>

<task type="auto">
  <name>Task 3: Update barrel export with all components</name>
  <files>
    src/components/SharedViz/index.ts
  </files>
  <action>
Update the barrel export to include StepControls and useAutoPlay:

**index.ts:**
```typescript
// Display components
export { CodePanel } from './CodePanel'
export type { CodePanelProps } from './CodePanel'

export { StepProgress } from './StepProgress'
export type { StepProgressProps } from './StepProgress'

// Interactive components
export { StepControls } from './StepControls'
export type { StepControlsProps } from './StepControls'

// Hooks
export { useAutoPlay } from './useAutoPlay'
export type { UseAutoPlayOptions } from './useAutoPlay'
```

Verify all exports resolve correctly.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - All exports present: `grep -c "export" src/components/SharedViz/index.ts` shows 8 lines
  </verify>
  <done>
    - index.ts exports all 4 components/hooks and their type interfaces
    - TypeScript resolves all imports without errors
  </done>
</task>

</tasks>

<verification>
1. `ls -la src/components/SharedViz/` shows all expected files (7 total after this plan)
2. `npx tsc --noEmit` passes with no errors
3. `npm run lint` passes (or has only pre-existing warnings)
4. Button styling matches EventLoopViz controls exactly
</verification>

<success_criteria>
- StepControls component exists with Prev/Next/Reset buttons
- Buttons disable correctly (Prev at start, Next at end)
- Next button shows 'Done' when at last step
- useAutoPlay hook exists and manages auto-play state
- Auto-play advances steps and pauses at end
- Barrel export includes all SharedViz components
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
