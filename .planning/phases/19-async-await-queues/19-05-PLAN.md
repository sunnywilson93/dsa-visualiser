---
phase: 19-async-await-queues
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Concepts/EventLoopTickViz.tsx
  - src/components/Concepts/index.ts
  - src/app/concepts/[conceptId]/ConceptPageClient.tsx
autonomous: true

must_haves:
  truths:
    - "User can see granular event loop tick cycle: check queues -> run task -> repeat"
    - "User can see current phase indicator (task/microtasks/render/idle)"
    - "User can see progressive detail by level (beginner simple, advanced full spec)"
    - "User can understand JavaScript is single-threaded through one-task-at-a-time"
  artifacts:
    - path: "src/components/Concepts/EventLoopTickViz.tsx"
      provides: "Event loop tick cycle visualization"
      min_lines: 300
      exports: ["EventLoopTickViz"]
  key_links:
    - from: "src/app/concepts/[conceptId]/ConceptPageClient.tsx"
      to: "EventLoopTickViz"
      via: "dynamic import"
      pattern: "event-loop-tick.*EventLoopTickViz"
---

<objective>
Create EventLoopTickViz component showing granular event loop tick cycle with phase indicators.

Purpose: Users understand the exact sequence of operations in one event loop iteration at their chosen detail level.
Output: EventLoopTickViz.tsx with progressive disclosure from simplified to full spec detail.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-async-await-queues/19-CONTEXT.md
@.planning/phases/19-async-await-queues/19-RESEARCH.md
@src/components/Concepts/EventLoopViz.tsx
@src/components/Concepts/EventLoopGranularViz.tsx
@src/components/SharedViz/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EventLoopTickViz component</name>
  <files>src/components/Concepts/EventLoopTickViz.tsx</files>
  <action>
Create EventLoopTickViz.tsx with circular event loop diagram and phase indicators:

1. Structure:
   - 'use client' directive at top
   - Import useState, motion/AnimatePresence
   - Import RefreshCw, Play, Pause from lucide-react
   - Import SharedViz components

2. Step interface:
   ```typescript
   interface Step {
     description: string
     codeLine: number
     callStack: string[]
     microQueue: string[]
     macroQueue: string[]
     currentPhase: 'idle' | 'task' | 'microtasks' | 'render' | 'idle-callbacks'
     loopIteration: number
     output: string[]
     phaseDetail: string
   }
   ```

3. Progressive disclosure by level:
   - Beginner: Simplified cycle (check -> run -> repeat)
     - Phases shown: idle, task (combined), repeat
     - Message: "JavaScript runs one task at a time"
   - Intermediate: Queue priority (task -> all microtasks -> task)
     - Phases shown: task, microtasks (with drain indicator), task
     - Message: "Microtasks always run before next macrotask"
   - Advanced: Full spec detail (task -> microtasks -> render -> idle callbacks)
     - Phases shown: task, microtasks, render, idle-callbacks
     - Message: "Rendering happens after microtasks, before next macrotask"

4. Visual layout:
   - Circular event loop diagram in center
   - Phase segments around the circle (like a clock or pie)
   - Current phase highlighted with glow effect
   - Position indicator rotating around the circle
   - Queues displayed below/beside the circle

5. Circular diagram styling:
   - SVG circle with phase arcs
   - Active phase: bright color, glow effect
   - Inactive phases: dimmed
   - Position indicator: animated dot moving around circle
   - Phase labels outside the circle

6. Phase colors (consistent theme):
   - Task (macrotask): amber/yellow
   - Microtasks: purple/violet
   - Render: blue/cyan
   - Idle: gray

7. Key insights by level:
   - Beginner: "JavaScript is single-threaded - one task at a time"
   - Intermediate: "Microtasks have priority - they ALL run before any macrotask"
   - Advanced: "Render step ensures smooth animations between tasks"

8. Examples:
   - Beginner: Simple setTimeout + console.log showing task queue
   - Intermediate: Promise + setTimeout showing priority
   - Advanced: requestAnimationFrame showing render timing
  </action>
  <verify>npm run build passes with no TypeScript errors</verify>
  <done>EventLoopTickViz.tsx exists with circular diagram and progressive phases</done>
</task>

<task type="auto">
  <name>Task 2: Wire EventLoopTickViz to routing</name>
  <files>src/components/Concepts/index.ts, src/app/concepts/[conceptId]/ConceptPageClient.tsx</files>
  <action>
1. In src/components/Concepts/index.ts:
   - Add export: `export { EventLoopTickViz } from './EventLoopTickViz'`

2. In src/app/concepts/[conceptId]/ConceptPageClient.tsx:
   - Update 'event-loop-tick' mapping (currently EventLoopGranularViz) to:
     `'event-loop-tick': dynamic(() => import('@/components/Concepts/EventLoopTickViz').then(m => m.EventLoopTickViz))`
  </action>
  <verify>npm run dev, navigate to /concepts/event-loop-tick, component renders without errors</verify>
  <done>event-loop-tick route renders EventLoopTickViz component</done>
</task>

</tasks>

<verification>
1. `npm run build` passes
2. `npm run lint` produces no new warnings
3. Navigate to /concepts/event-loop-tick - component loads
4. Verify circular diagram renders correctly
5. Step through beginner - verify simplified phases
6. Step through intermediate - verify queue priority shown
7. Step through advanced - verify render step included
8. Verify phase indicator animates around circle
</verification>

<success_criteria>
- EventLoopTickViz.tsx exists with circular event loop diagram
- Progressive disclosure: beginner simple, advanced full spec
- Current phase indicator visible and animated
- Phase colors consistent with other queue visualizations
- Loop iteration counter shown
- 3 difficulty levels with appropriate detail
- Mobile responsive layout
</success_criteria>

<output>
After completion, create `.planning/phases/19-async-await-queues/19-05-SUMMARY.md`
</output>
