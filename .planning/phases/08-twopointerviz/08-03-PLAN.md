---
phase: 08-twopointerviz
plan: 03
type: execute
wave: 3
depends_on: ["08-02"]
files_modified:
  - src/components/DSAPatterns/TwoPointersViz/TwoPointersViz.tsx
autonomous: true

must_haves:
  truths:
    - "User can select advanced difficulty and see 2 examples"
    - "User can step through Sort Colors (Dutch Flag) example"
    - "User can step through Trapping Rain Water example"
    - "Partition variant tab shows Sort Colors example"
    - "All three variant tabs have at least one example"
  artifacts:
    - path: "src/components/DSAPatterns/TwoPointersViz/TwoPointersViz.tsx"
      provides: "Advanced examples completing the visualization"
      contains: "sort-colors"
  key_links:
    - from: "TwoPointersViz examples.advanced"
      to: "2 TwoPointerExample objects"
      via: "array entries"
      pattern: "advanced.*sort-colors.*trapping-rain-water"
---

<objective>
Add advanced-level examples to TwoPointersViz, completing the visualization with partition variant examples.

Purpose: Provide challenging examples demonstrating advanced two-pointer techniques including three-way partitioning and complex multi-pass logic.

Output: Complete TwoPointersViz with all 7 examples across 3 difficulty levels and 3 variants.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/08-twopointerviz/08-CONTEXT.md
@.planning/phases/08-twopointerviz/08-02-SUMMARY.md
@src/components/DSAPatterns/TwoPointersViz/TwoPointersViz.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Sort Colors (Dutch Flag) example (partition)</name>
  <files>src/components/DSAPatterns/TwoPointersViz/TwoPointersViz.tsx</files>
  <action>
Add to examples.advanced:

**Sort Colors / Dutch National Flag** (partition variant)
- Problem: Sort array of 0s, 1s, 2s in-place with single pass
- Array: [2, 0, 2, 1, 1, 0]
- Use three pointers: low (0s boundary), mid (current), high (2s boundary)
- ~12-15 steps showing:
  - Init: low=0, mid=0, high=5
  - If nums[mid]==0: swap with low, increment both
  - If nums[mid]==1: just increment mid
  - If nums[mid]==2: swap with high, decrement high (don't increment mid!)
- variant: 'partition'

For partition variant, need to handle THREE pointers visually:
- Show "low", "mid", "high" labels
- When mid and low or mid and high collide, show combined labels

Step structure needs extended pointers:
```typescript
pointers: {
  left: 0,   // low pointer
  right: 5,  // high pointer
  mid?: 0    // optional mid pointer for partition
}
```

Update the component to handle optional `mid` pointer when variant is 'partition'.

Decision format: "nums[mid] == 0? Yes -> swap nums[low] and nums[mid], increment both"

Cell coloring for partition:
- Index < low: show as region 0 (red/processed)
- Index between low and mid: show as region 1 (gray/active)
- Index > high: show as region 2 (blue/processed)
- Current mid position highlighted

insight: "Three-way partition keeps 0s left of low, 2s right of high. Mid scans once through the array."
  </action>
  <verify>
    - `npm run build` passes
    - Sort Colors appears in advanced under Partition variant
    - Partition variant tab shows Sort Colors example
    - Three pointer labels display correctly
  </verify>
  <done>Sort Colors (Dutch Flag) example added with three-pointer visualization. Partition variant now has content.</done>
</task>

<task type="auto">
  <name>Task 2: Add Trapping Rain Water example (converging)</name>
  <files>src/components/DSAPatterns/TwoPointersViz/TwoPointersViz.tsx</files>
  <action>
Add to examples.advanced:

**Trapping Rain Water** (converging variant)
- Problem: Calculate total water trapped between bars
- Array: [0, 1, 0, 2, 1, 0, 1, 3, 2, 1, 2, 1] (heights)
- Use converging pointers with leftMax and rightMax tracking
- ~18-22 steps showing:
  - Init: left=0, right=11, leftMax=0, rightMax=0
  - Compare height[left] vs height[right]
  - If left is shorter: process left side (water = leftMax - height[left]), update leftMax, move left
  - If right is shorter: process right side, update rightMax, move right
  - Accumulate total water
- variant: 'converging'

Track additional state in output array:
- Show leftMax, rightMax, totalWater values updating

Decision format: "height[left] (0) <= height[right] (1)? Yes -> process left. Water at left = max(0, leftMax - height[left]) = 0"

Visualization enhancements for this example:
- Consider showing water level indication in cells (optional: could just describe in steps)
- Show running total of water trapped

insight: "Process the shorter side - it's bounded by a taller bar on the other side. Track max heights to calculate water."
  </action>
  <verify>
    - `npm run build` passes
    - Trapping Rain Water appears in advanced under Converging variant
    - Step through shows leftMax/rightMax/total tracking
    - Full trace from start to completion
  </verify>
  <done>Trapping Rain Water example added. Phase 8 complete with all 7 examples across 3 difficulties and 3 variants.</done>
</task>

<task type="auto">
  <name>Task 3: Final verification and polish</name>
  <files>src/components/DSAPatterns/TwoPointersViz/TwoPointersViz.tsx</files>
  <action>
Verify all examples work correctly and polish any rough edges:

1. Ensure all variant tabs show appropriate examples:
   - Converging: Two Sum II, Valid Palindrome (beginner), Container With Most Water, 3Sum (intermediate), Trapping Rain Water (advanced)
   - Same Direction: Remove Duplicates (intermediate)
   - Partition: Sort Colors (advanced)

2. When switching variants, if current level has no examples for that variant:
   - Either show "No examples at this level for this variant"
   - Or automatically switch to a level that has examples

3. Verify pointer label logic:
   - Converging: L/R
   - Same Direction: slow/fast
   - Partition: low/mid/high

4. Test edge cases:
   - Variant switch resets step to 0
   - Level switch resets step to 0
   - Example switch resets step to 0

5. Run lint and build to ensure no regressions.
  </action>
  <verify>
    - `npm run build` passes
    - `npm run lint` passes
    - All 7 examples accessible through appropriate variant/level combinations
    - No console errors when switching variants/levels/examples
  </verify>
  <done>All 7 examples working. Variant tabs show correct examples. Pointer labels match variant type. Phase 8 TwoPointersViz complete.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npm run lint` passes
3. Navigate to /concepts/dsa/patterns/two-pointers
4. Test all difficulty levels:
   - Beginner: 2 examples (Two Sum II, Valid Palindrome)
   - Intermediate: 3 examples (Container With Most Water, 3Sum, Remove Duplicates)
   - Advanced: 2 examples (Sort Colors, Trapping Rain Water)
5. Test all variant tabs:
   - Converging: 5 examples across levels
   - Same Direction: 1 example (intermediate)
   - Partition: 1 example (advanced)
6. Sort Colors shows three pointers (low/mid/high)
7. Step through each example - decision logic displays correctly
8. Pointer animations smooth
</verification>

<success_criteria>
- Advanced difficulty shows 2 examples
- Sort Colors uses three-pointer (low/mid/high) visualization
- Trapping Rain Water shows leftMax/rightMax tracking
- All three variant tabs functional with content
- Complete coverage: 7 examples, 3 difficulties, 3 variants
- Phase 8 requirements TP-01 through TP-06 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/08-twopointerviz/08-03-SUMMARY.md`
</output>
