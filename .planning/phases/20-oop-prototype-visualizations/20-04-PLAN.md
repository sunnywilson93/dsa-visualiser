---
phase: 20-oop-prototype-visualizations
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Concepts/PrototypeInheritanceViz.tsx
  - src/components/Concepts/PrototypePollutionViz.tsx
  - src/components/Concepts/index.ts
  - src/app/concepts/[conceptId]/ConceptPageClient.tsx
autonomous: true

must_haves:
  truths:
    - "User can see extends keyword linking prototypes between parent and child classes"
    - "User can step through super() call showing parent constructor invocation"
    - "User can see full inheritance chain: instance -> Child.prototype -> Parent.prototype -> Object.prototype -> null"
    - "User can see prototype pollution adding properties to Object.prototype"
    - "User can see all objects affected by pollution with visual ripple effect"
    - "User can see prevention techniques (Object.freeze, Object.seal) as resolution"
  artifacts:
    - path: "src/components/Concepts/PrototypeInheritanceViz.tsx"
      provides: "Extends/super visualization with prototype linking and constructor flow"
      min_lines: 400
    - path: "src/components/Concepts/PrototypePollutionViz.tsx"
      provides: "Pollution danger visualization with warning styling and prevention techniques"
      min_lines: 350
  key_links:
    - from: "src/app/concepts/[conceptId]/ConceptPageClient.tsx"
      to: "PrototypeInheritanceViz"
      via: "dynamic import mapping"
      pattern: "prototype-inheritance.*PrototypeInheritanceViz"
    - from: "src/app/concepts/[conceptId]/ConceptPageClient.tsx"
      to: "PrototypePollutionViz"
      via: "dynamic import mapping"
      pattern: "prototype-pollution.*PrototypePollutionViz"
---

<objective>
Create PrototypeInheritanceViz and PrototypePollutionViz components showing class inheritance mechanics and prototype pollution dangers.

Purpose: Enable learners to understand how extends/super work (prototype linking + constructor invocation) and the security dangers of prototype pollution with prevention techniques.

Output: Two visualization components covering OOP-05 and OOP-06 requirements, wired to concept routes.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-oop-prototype-visualizations/20-CONTEXT.md
@.planning/phases/20-oop-prototype-visualizations/20-RESEARCH.md
@src/components/Concepts/PrototypesViz.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PrototypeInheritanceViz component</name>
  <files>
    src/components/Concepts/PrototypeInheritanceViz.tsx
  </files>
  <action>
Create PrototypeInheritanceViz.tsx showing extends/super mechanics:

**Structure:**
- 'use client' directive at top
- Level selector (beginner/intermediate/advanced) with color-coded badges
- Example selector for each level
- Code panel with extends syntax
- Prototype linking visualization
- super() call flow animation

**Step Interface:**
```typescript
interface InheritanceStep {
  description: string
  code: string[]
  codeHighlight?: number
  superCallActive?: boolean          // True when super() is being called
  prototypeLink?: { from: string; to: string }  // Shows linking happening
  chain: ChainNode[]
  constructorStack?: string[]        // Shows super() calling parent constructor
  output: string[]
  phase: 'class-definition' | 'prototype-linking' | 'super-call' | 'instance-creation'
}
```

**Examples to create:**
- Beginner: Simple Dog extends Animal with super(name)
- Beginner: Method override with super.method() call
- Intermediate: Multi-level inheritance (GoldenRetriever -> Dog -> Animal)
- Intermediate: Static method inheritance
- Advanced: Mixins and composition patterns
- Advanced: Prototype chain manipulation (Object.setPrototypeOf dangers)

**Visual requirements (from CONTEXT.md - locked decisions):**
- Both constructor call mechanics AND prototype chain structure shown
- super() invocation flow shown (call stack style)
- Child.prototype.__proto__ === Parent.prototype linking shown explicitly

**Two-part visualization:**

1. **Prototype Linking Diagram:**
```
   Dog.prototype
        |
   __proto__
        v
   Animal.prototype
        |
   __proto__
        v
   Object.prototype
        |
   __proto__
        v
      null
```

2. **super() Call Flow (when active):**
```
+------------------+
| Dog constructor  |  <- Current
|   super(name)    |
+------------------+
        |
        v calls
+------------------+
| Animal(name)     |  <- Parent constructor
|   this.name = .. |
+------------------+
```

**Key insights to highlight:**
- extends sets up prototype chain BEFORE any constructor runs
- super() must be called before using 'this' in derived class
- Methods on parent prototype are available to child instances
  </action>
  <verify>
    npm run build -- --filter=PrototypeInheritanceViz
    grep -l "super()" src/components/Concepts/PrototypeInheritanceViz.tsx
  </verify>
  <done>
    PrototypeInheritanceViz.tsx exists with prototype linking visualization, super() call flow, 3 difficulty levels, and full inheritance chain display.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PrototypePollutionViz component</name>
  <files>
    src/components/Concepts/PrototypePollutionViz.tsx
  </files>
  <action>
Create PrototypePollutionViz.tsx showing pollution dangers and prevention:

**Structure:**
- 'use client' directive at top
- Level selector (intermediate/advanced ONLY - no beginner per CONTEXT.md)
- Example selector for each level
- Normal -> Polluting -> Affected -> Prevention flow

**Step Interface:**
```typescript
interface PollutionStep {
  description: string
  code: string[]
  codeHighlight?: number
  pollutedProperty?: { name: string; value: string }
  affectedObjects: string[]           // Objects showing the polluted property
  showWarning: boolean
  showAffectedRipple: boolean
  prevention?: 'freeze' | 'seal' | 'hasOwn' | 'createNull'
  output: string[]
  phase: 'normal' | 'polluting' | 'affected' | 'prevention'
}
```

**Examples to create (from CONTEXT.md - locked decisions):**
- Intermediate: Simple pollution example (Object.prototype.isAdmin = true)
- Intermediate: Show Object.create(null) as safe alternative
- Advanced: Security implications (access control bypass)
- Advanced: Object.freeze(Object.prototype) prevention
- Advanced: Object.hasOwn() checking pattern
- Advanced: Library vulnerabilities (lodash merge example concept)

**Visual requirements (from CONTEXT.md - locked decisions):**
- Include at intermediate AND advanced difficulty levels (no beginner)
- Show prevention (Object.freeze, Object.seal) as final steps AFTER demonstrating danger
- Red warning styling with AlertTriangle icon for pollution warning
- Shield icon for prevention resolution

**Animation sequence:**
1. **Normal phase:** Show clean objects with no polluted properties
2. **Polluting phase:** Show code modifying Object.prototype
   - Red warning badge appears: "Prototype Pollution!"
   - AlertTriangle icon from lucide-react
3. **Affected phase:** Show multiple objects now have the polluted property
   - Ripple/pulse animation on affected objects (red glow)
   - Polluted property appears in each object with danger indicator
4. **Prevention phase:** Show Object.freeze/seal/hasOwn pattern
   - Shield icon from lucide-react
   - Green success styling
   - "Protected!" badge

**Visual styling (from RESEARCH.md):**
```typescript
// Warning badge:
<motion.div className="flex items-center gap-2 px-4 py-2 bg-red-500/10 border border-red-500/30 rounded-lg">
  <AlertTriangle className="text-red-400" size={20} />
  <span className="text-red-400 font-medium">Prototype Pollution!</span>
</motion.div>

// Affected object ripple:
<motion.div
  className="border-2 border-red-500/50 bg-red-500/5"
  animate={{
    boxShadow: step.affectedObjects.includes(obj.id)
      ? ['0 0 0 rgba(239,68,68,0)', '0 0 20px rgba(239,68,68,0.3)', '0 0 0 rgba(239,68,68,0)']
      : '0 0 0 rgba(239,68,68,0)'
  }}
  transition={{ duration: 1.5, repeat: Infinity }}
/>

// Prevention resolution:
<motion.div className="flex items-center gap-2 px-4 py-2 bg-emerald-500/10 border border-emerald-500/30 rounded-lg">
  <Shield className="text-emerald-400" size={20} />
  <span className="text-emerald-400 font-medium">Object.freeze() prevents modification!</span>
</motion.div>
```

Import AlertTriangle and Shield from lucide-react.
  </action>
  <verify>
    npm run build -- --filter=PrototypePollutionViz
    grep -l "AlertTriangle\|Shield" src/components/Concepts/PrototypePollutionViz.tsx
  </verify>
  <done>
    PrototypePollutionViz.tsx exists with pollution warning, affected objects ripple effect, prevention techniques, lucide-react icons, and intermediate/advanced levels only.
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire components to routing</name>
  <files>
    src/components/Concepts/index.ts
    src/app/concepts/[conceptId]/ConceptPageClient.tsx
  </files>
  <action>
**In src/components/Concepts/index.ts:**
Add exports for both new components:
```typescript
export { PrototypeInheritanceViz } from './PrototypeInheritanceViz'
export { PrototypePollutionViz } from './PrototypePollutionViz'
```

**In src/app/concepts/[conceptId]/ConceptPageClient.tsx:**
Update the vizMap to use the new dedicated components instead of PrototypesViz:

Find the existing mappings:
```typescript
'prototype-inheritance': dynamic(() => import('@/components/Concepts/PrototypesViz').then(m => m.PrototypesViz)),
'prototype-pollution': dynamic(() => import('@/components/Concepts/PrototypesViz').then(m => m.PrototypesViz)),
```

Replace with:
```typescript
'prototype-inheritance': dynamic(() => import('@/components/Concepts/PrototypeInheritanceViz').then(m => m.PrototypeInheritanceViz)),
'prototype-pollution': dynamic(() => import('@/components/Concepts/PrototypePollutionViz').then(m => m.PrototypePollutionViz)),
```
  </action>
  <verify>
    npm run build
    npm run lint
  </verify>
  <done>
    Both components exported and wired to their concept routes. Build passes. Navigating to /concepts/prototype-inheritance shows PrototypeInheritanceViz. Navigating to /concepts/prototype-pollution shows PrototypePollutionViz.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npm run lint` produces no new warnings
3. Navigate to /concepts/prototype-inheritance - PrototypeInheritanceViz renders with level selector
4. Navigate to /concepts/prototype-pollution - PrototypePollutionViz renders with intermediate/advanced levels only
5. Level switching works on both components
6. Step navigation works on both components
7. super() call flow visible in PrototypeInheritanceViz
8. Pollution warning and affected ripple visible in PrototypePollutionViz
9. Prevention techniques shown with Shield icon
</verification>

<success_criteria>
- OOP-05 satisfied: Extends/super visualization shows prototype linking between parent and child classes
- OOP-06 satisfied: Prototype pollution visualization shows dangers of modifying Object.prototype with affected objects highlighted
- PrototypeInheritanceViz has 3 difficulty levels
- PrototypePollutionViz has intermediate/advanced levels only (no beginner)
- Prevention techniques (Object.freeze/seal) shown as resolution after danger
- Lucide-react icons used for warnings and prevention
- Mobile responsive
</success_criteria>

<output>
After completion, create `.planning/phases/20-oop-prototype-visualizations/20-04-SUMMARY.md`
</output>
