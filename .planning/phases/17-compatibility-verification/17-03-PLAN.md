---
phase: 17-compatibility-verification
plan: 03
type: execute
wave: 2
depends_on: ["17-01", "17-02"]
files_modified:
  - src/styles/globals.css
autonomous: true

must_haves:
  truths:
    - "npm run check:vars exits 0 with all var() references resolved"
    - "npm run check:keyframes exits 0 with zero @keyframes in CSS Modules"
    - "npm run build passes with zero errors"
    - "npm run lint produces no new warnings"
  artifacts: []
  key_links: []
---

<objective>
Run all static analysis scripts from Plan 01, fix any broken var() references or issues found, and confirm build + lint pass cleanly with the preflight overrides from Plan 02 in place.

Purpose: This is the "fix" step -- Plan 01 created the detection tools, Plan 02 added preflight overrides, and this plan uses those tools to find and fix any remaining issues before visual testing.

Output: Clean passes on check:vars, check:keyframes, build, and lint. Any broken references fixed in globals.css or CSS Module files.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-compatibility-verification/17-01-SUMMARY.md
@.planning/phases/17-compatibility-verification/17-02-SUMMARY.md
@src/styles/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run static analysis and fix all issues</name>
  <files>src/styles/globals.css</files>
  <action>
Run the three analysis scripts in sequence:

1. `npm run check:vars` -- If any unresolved var() references are reported:
   - For each unresolved reference, determine if it should be:
     a) Added to the dynamic-props allowlist in check-vars.ts (if it's set via inline styles from React)
     b) Added to globals.css @theme or @layer base :root (if it's a missing token)
     c) Fixed in the CSS Module file (if it's a typo or renamed property)
   - Fix ALL unresolved references. Zero tolerance.
   - Re-run `npm run check:vars` to confirm all pass.

2. `npm run check:keyframes` -- Should pass (Phase 16 consolidated all keyframes). If any are found, move them to @theme block in globals.css and remove from the module file.

3. `npm run tokens:audit` -- Review the output. Note any unused tokens (informational, no action needed). Confirm unresolved count matches expectations.

4. `npm run build` -- Must pass with zero errors.

5. `npm run lint` -- Must produce no new warnings vs baseline. If new warnings appear from the preflight overrides or any changes made, fix them.
  </action>
  <verify>
Run all five commands in sequence:
- `npm run check:vars` exits 0
- `npm run check:keyframes` exits 0
- `npm run tokens:audit` runs successfully
- `npm run build` exits 0
- `npm run lint` exits 0
  </verify>
  <done>All static analysis passes clean. Build compiles with zero errors. Lint shows no new warnings. Every var() reference in every CSS Module resolves to a defined custom property.</done>
</task>

</tasks>

<verification>
1. `npm run check:vars` exits 0
2. `npm run check:keyframes` exits 0
3. `npm run build` exits 0
4. `npm run lint` exits 0
</verification>

<success_criteria>
All analysis scripts pass clean. Build and lint pass. Zero broken var() references remain. Zero @keyframes in CSS Modules.
</success_criteria>

<output>
After completion, create `.planning/phases/17-compatibility-verification/17-03-SUMMARY.md`
</output>
