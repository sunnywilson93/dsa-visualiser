---
phase: 03-variablesviz
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/Concepts/VariablesViz.tsx
  - src/components/Concepts/VariablesViz.module.css
autonomous: true

must_haves:
  truths:
    - "User can select Intermediate level with 4 examples"
    - "Scope chain visualization shows nested scope boxes"
    - "Scope lookup animation highlights scopes being searched"
    - "Variable shadowing example shows inner variable hiding outer"
    - "var escapes block scope while let stays contained"
  artifacts:
    - path: "src/components/Concepts/VariablesViz.tsx"
      provides: "Intermediate examples with scope chain visualization"
      contains: "scopeChain"
    - path: "src/components/Concepts/VariablesViz.module.css"
      provides: "Scope chain box styling"
      contains: "scopeBox"
  key_links:
    - from: "src/components/Concepts/VariablesViz.tsx"
      to: "scope visualization"
      via: "scopes array and lookupPath in steps"
      pattern: "lookupPath"
---

<objective>
Add intermediate examples with scope chain visualization and lookup animation.

Purpose: Enable learners to understand scope chain lookups, variable shadowing, and the difference between function scope (var) and block scope (let/const). The scope visualization animates the "search" from inner scope outward.

Output: VariablesViz with 8 total examples (4 beginner + 4 intermediate), scope chain visualization panel, and lookup animation.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-variablesviz/03-CONTEXT.md
@.planning/phases/03-variablesviz/03-RESEARCH.md
@.planning/phases/03-variablesviz/03-01-SUMMARY.md
@src/components/Concepts/VariablesViz.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add 4 intermediate examples with scope data</name>
  <files>src/components/Concepts/VariablesViz.tsx</files>
  <action>
Add intermediate level examples to the examples Record. Enable Intermediate level in the level selector.

Create 4 intermediate examples:

1. **var-vs-let-hoisting** (~8 steps): Side-by-side comparison
   - Code:
     ```javascript
     console.log(a);  // undefined (var hoisted)
     console.log(b);  // Would be TDZ error (show conceptually)
     var a = 1;
     let b = 2;
     console.log(a, b);
     ```
   - Show var as hoisted-undefined, let as hoisted-tdz state
   - No actual error thrown (intermediate, not advanced)
   - Steps show creation phase first (hoisting), then execution phase

2. **function-vs-block-scope** (~8 steps): var escapes block
   - Code:
     ```javascript
     function test() {
       if (true) {
         var x = 1;
         let y = 2;
       }
       console.log(x);  // 1 (var escapes!)
       console.log(y);  // Would error (show conceptually)
     }
     test();
     ```
   - Include scopes array showing function scope and block scope
   - Show x exists in function scope, y only in block scope
   - After block ends, y is gone but x remains

3. **scope-chain-lookup** (~7 steps): Nested scope accessing outer variable
   - Code:
     ```javascript
     let name = 'Alice';
     function greet() {
       console.log(name);  // Looks up scope chain
     }
     greet();
     ```
   - Steps include lookupPath array: ['function:greet', 'global']
   - Shows search animation moving from inner scope to outer until found

4. **variable-shadowing** (~8 steps): Inner variable hides outer
   - Code:
     ```javascript
     let x = 'outer';
     function inner() {
       let x = 'inner';  // Shadows outer x
       console.log(x);   // 'inner'
     }
     inner();
     console.log(x);     // 'outer'
     ```
   - Both x variables visible in variables panel (different scopes)
   - lookupPath shows only inner scope searched (variable found immediately)

Each step needs:
- scopes: Scope[] array showing current scope structure
- lookupPath?: string[] for lookup animation (scope ids in order searched)
- Variables with scope and scopeLevel set correctly
  </action>
  <verify>
File contains:
- `intermediate:` array with 4 examples
- Each example has scopes data in steps
- At least one example has lookupPath for lookup animation
- Level selector logic enables Intermediate
  </verify>
  <done>
4 intermediate examples with scope and lookupPath data ready for visualization.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build scope chain visualization panel</name>
  <files>src/components/Concepts/VariablesViz.tsx</files>
  <action>
Add a scope chain visualization panel that renders when the current step has scopes data.

1. **Conditional rendering:**
```typescript
{currentStep.scopes && currentStep.scopes.length > 0 && (
  <div className={styles.scopeChainPanel}>
    <div className={styles.boxHeader}>Scope Chain</div>
    <div className={styles.scopeChain}>
      {/* Render nested scope boxes */}
    </div>
  </div>
)}
```

2. **Nested scope boxes pattern:**
Render scopes from outermost (global) to innermost. Each scope is a box that contains:
- Scope label (e.g., "Global", "function: greet", "block")
- Variables in that scope with their current values
- Nested inner scopes

Visual structure (nested boxes):
```
┌─ Global ─────────────────────┐
│  name = "Alice"              │
│  ┌─ function: greet ───────┐ │
│  │  (searching here...)    │ │
│  └─────────────────────────┘ │
└──────────────────────────────┘
```

3. **Lookup animation:**
When lookupPath is present, highlight scopes being searched:
```typescript
const isBeingSearched = (scopeId: string) =>
  currentStep.lookupPath?.includes(scopeId)

const isCurrentSearch = (scopeId: string) =>
  currentStep.lookupPath?.[0] === scopeId

// Apply highlight styles when being searched
className={`${styles.scopeBox} ${
  isBeingSearched(scope.id) ? styles.scopeSearched : ''
} ${
  isCurrentSearch(scope.id) ? styles.scopeCurrentSearch : ''
}`}
```

4. **Variable display in scope:**
```typescript
<div className={styles.scopeVariables}>
  {scope.variables.map(varName => {
    const variable = currentStep.variables.find(v => v.name === varName)
    return variable ? (
      <div key={varName} className={styles.scopeVar}>
        <span style={{ color: keywordColors[variable.keyword] }}>
          {variable.keyword}
        </span>
        {variable.name} = {variable.value ?? 'undefined'}
      </div>
    ) : null
  })}
</div>
```

5. **Use framer-motion for smooth transitions:**
```typescript
<motion.div
  className={styles.scopeBox}
  animate={
    isCurrentSearch(scope.id)
      ? { borderColor: '#10b981', boxShadow: '0 0 15px rgba(16, 185, 129, 0.4)' }
      : { borderColor: 'rgba(148, 163, 184, 0.2)', boxShadow: 'none' }
  }
  transition={{ duration: 0.3 }}
>
```

6. **Layout adjustment:**
When scope chain panel is visible, adjust the main grid to accommodate it (potentially 3 columns or stack differently).
  </action>
  <verify>
Navigate to /concepts/variables, select Intermediate level, select scope-chain-lookup example:
- Scope chain panel appears
- Nested boxes show Global and function scopes
- Variable names visible in each scope
- Lookup animation highlights scopes during access steps
  </verify>
  <done>
Scope chain visualization panel renders with nested boxes and lookup highlighting.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add CSS for scope chain visualization</name>
  <files>src/components/Concepts/VariablesViz.module.css</files>
  <action>
Add CSS for the scope chain panel and nested scope boxes.

1. **Scope chain panel (neon box style):**
```css
.scopeChainPanel {
  --neon-start: #8b5cf6;  /* Purple */
  --neon-end: #3b82f6;    /* Blue */
}
```

2. **Scope chain container:**
```css
.scopeChain {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}
```

3. **Scope box (nested appearance):**
```css
.scopeBox {
  background: rgba(30, 41, 59, 0.5);
  border: 2px solid rgba(148, 163, 184, 0.2);
  border-radius: 8px;
  padding: 0.75rem;
  margin-left: 1rem;  /* Creates nesting visual */
  transition: border-color 0.3s, box-shadow 0.3s;
}

.scopeBox:first-child {
  margin-left: 0;  /* Global scope not indented */
}

/* Nested scope boxes */
.scopeBox .scopeBox {
  margin-top: 0.5rem;
  background: rgba(30, 41, 59, 0.7);
}
```

4. **Scope label:**
```css
.scopeLabel {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--js-text-secondary);
  margin-bottom: 0.5rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.scopeLabel.global { color: #10b981; }
.scopeLabel.function { color: #3b82f6; }
.scopeLabel.block { color: #f59e0b; }
```

5. **Search animation states:**
```css
.scopeSearched {
  border-color: rgba(16, 185, 129, 0.3);
}

.scopeCurrentSearch {
  border-color: #10b981 !important;
  box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
}
```

6. **Scope variables list:**
```css
.scopeVariables {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.scopeVar {
  font-family: var(--font-mono, monospace);
  font-size: 0.8rem;
  color: var(--js-text-primary);
  padding: 0.25rem 0.5rem;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 4px;
}
```

7. **Grid layout update:**
Adjust main grid to accommodate scope chain panel when visible:
```css
.mainGrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.mainGridWithScope {
  grid-template-columns: 1fr 1fr 1fr;
}

@media (max-width: 900px) {
  .mainGrid, .mainGridWithScope {
    grid-template-columns: 1fr;
  }
}
```

8. **Legend update:**
Add scope type indicators to legend if needed.
  </action>
  <verify>
```bash
npm run build
```
Build passes. Visual check:
- Scope chain panel has purple-blue gradient border
- Nested scope boxes indent correctly
- Global/function/block labels have distinct colors
- Search animation glows green on active scope
- Responsive stacking on mobile
  </verify>
  <done>
CSS complete for scope chain visualization with nested boxes, search animation, and responsive layout.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **TypeScript compiles:** `npx tsc --noEmit`
2. **Build passes:** `npm run build`
3. **Level selector:** Intermediate now enabled
4. **Example count:** 4 intermediate examples visible in tabs
5. **Scope chain panel:** Appears on intermediate examples
6. **Nested boxes:** Scopes render as nested visual containers
7. **Lookup animation:** Green glow moves through scopes during lookup
8. **Shadowing:** Both variables visible, only inner one accessed
9. **Block scope:** var escapes block, let does not
</verification>

<success_criteria>
- [ ] Intermediate level enabled with 4 examples
- [ ] Scope chain visualization panel renders with nested boxes
- [ ] Lookup animation highlights scopes being searched
- [ ] Shadowing example shows both variables clearly
- [ ] Block scope vs function scope difference visualized
- [ ] TypeScript compiles, build passes
</success_criteria>

<output>
After completion, create `.planning/phases/03-variablesviz/03-02-SUMMARY.md`
</output>
