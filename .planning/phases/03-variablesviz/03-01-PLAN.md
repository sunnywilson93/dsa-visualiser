---
phase: 03-variablesviz
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Concepts/VariablesViz.tsx
  - src/components/Concepts/VariablesViz.module.css
autonomous: true

must_haves:
  truths:
    - "User can select Beginner level (Intermediate/Advanced disabled)"
    - "User can switch between 4 beginner example tabs"
    - "User can step forward and backward through each example"
    - "Code panel highlights current line synchronized with step"
    - "Variables panel shows variables with keyword colors and states"
  artifacts:
    - path: "src/components/Concepts/VariablesViz.tsx"
      provides: "Types, beginner examples data, core component with level selector, example tabs, SharedViz integration"
      min_lines: 400
      contains: "type Level"
    - path: "src/components/Concepts/VariablesViz.module.css"
      provides: "Styling matching LoopsViz patterns with CSS variables"
      min_lines: 200
  key_links:
    - from: "src/components/Concepts/VariablesViz.tsx"
      to: "@/components/SharedViz"
      via: "import { CodePanel, StepProgress, StepControls }"
      pattern: "from '@/components/SharedViz'"
---

<objective>
Rewrite VariablesViz with types, beginner examples, and core component structure matching LoopsViz patterns.

Purpose: Establish the foundation for VariablesViz with level selector, example tabs, and SharedViz integration. Beginner examples demonstrate happy path (no errors) for var, let, const, and basic block scope.

Output: Working VariablesViz component with 4 beginner examples steppable via SharedViz controls.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-variablesviz/03-CONTEXT.md
@.planning/phases/03-variablesviz/03-RESEARCH.md
@.planning/phases/02-loopsviz/02-01-SUMMARY.md
@src/components/Concepts/LoopsViz.tsx
@src/components/Concepts/VariablesViz.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create types and beginner example data</name>
  <files>src/components/Concepts/VariablesViz.tsx</files>
  <action>
Replace the existing VariablesViz.tsx with new implementation. Start with type definitions:

```typescript
type Level = 'beginner' | 'intermediate' | 'advanced'

type VariableState =
  | 'not-declared'
  | 'hoisted-undefined'
  | 'hoisted-tdz'
  | 'initialized'
  | 'error'

interface Variable {
  name: string
  keyword: 'var' | 'let' | 'const'
  value: string | undefined
  state: VariableState
  scope: string           // 'global' | 'function:name' | 'block:N'
  scopeLevel: number
}

interface Scope {
  id: string
  type: 'global' | 'function' | 'block'
  name: string
  level: number
  variables: string[]
}

interface VariableStep {
  id: number
  codeLine: number
  description: string
  phase: 'creation' | 'execution'
  action: 'declare' | 'hoist' | 'access' | 'assign' | 'lookup' | 'error'
  variables: Variable[]
  scopes?: Scope[]
  lookupPath?: string[]
  output: string[]
  error?: string
}

interface VariableExample {
  id: string
  title: string
  code: string[]
  steps: VariableStep[]
  insight: string
  whyItMatters?: string
}
```

Add levelInfo configuration (same pattern as LoopsViz).

Create 4 beginner examples:

1. **var-declaration** (~6 steps): Basic var with hoisting showing undefined
   - Code: `console.log(x); var x = 5; console.log(x);`
   - Show var hoisted with undefined, then initialized to 5
   - All steps have phase: 'creation' then 'execution'
   - Variable state: not-declared -> hoisted-undefined -> initialized

2. **let-declaration** (~5 steps): let with block scope
   - Code: `let y = 10; console.log(y); y = 20; console.log(y);`
   - Show let in TDZ conceptually (just mention, no error in beginner)
   - Variable state: initialized from the start (no hoisting shown)

3. **const-declaration** (~5 steps): const with object mutation
   - Code: `const person = { name: 'Alice' }; person.name = 'Bob'; console.log(person.name);`
   - Show const binding is fixed but object internals can change
   - Variable state: initialized

4. **basic-block-scope** (~6 steps): let inside if block
   - Code: `let x = 'outer'; if (true) { let x = 'inner'; console.log(x); } console.log(x);`
   - Show inner x created, used, then gone after block
   - Two separate scope displays (outer and block)

Keep examples simple - no error states in beginner level.
  </action>
  <verify>
File contains:
- All 5 type definitions (Level, VariableState, Variable, Scope, VariableStep, VariableExample)
- levelInfo object with beginner/intermediate/advanced
- 4 beginner examples with steps arrays
- Each step has all required fields (id, codeLine, description, phase, action, variables, output)
  </verify>
  <done>
Types defined, levelInfo configured, 4 beginner examples with complete step data ready for rendering.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build core component with SharedViz integration</name>
  <files>src/components/Concepts/VariablesViz.tsx</files>
  <action>
Create the VariablesViz component following LoopsViz patterns:

1. **State management:**
```typescript
const [level, setLevel] = useState<Level>('beginner')
const [exampleIndex, setExampleIndex] = useState(0)
const [stepIndex, setStepIndex] = useState(0)
```

2. **Cascade reset handlers:**
```typescript
const handleLevelChange = (newLevel: Level) => {
  setLevel(newLevel)
  setExampleIndex(0)
  setStepIndex(0)
}

const handleExampleChange = (index: number) => {
  setExampleIndex(index)
  setStepIndex(0)
}
```

3. **Import SharedViz components:**
```typescript
import { CodePanel, StepProgress, StepControls } from '@/components/SharedViz'
```

4. **Component structure (matching LoopsViz layout):**
- Level selector pills (Beginner enabled, Intermediate/Advanced disabled for now)
- Example tabs with glow effect on active
- Two-column grid:
  - Left: CodePanel with line highlighting
  - Right: Variables panel (neon box style) showing variables with state colors
- Output/Console panel
- StepProgress with description
- StepControls for navigation
- Key Insight box at bottom

5. **Variable state colors:**
```typescript
const stateColors = {
  'not-declared': '#6b7280',    // Gray
  'hoisted-undefined': '#f59e0b', // Orange
  'hoisted-tdz': '#ef4444',      // Red
  'initialized': '#10b981',      // Green
  'error': '#ef4444'             // Red
}

const keywordColors = {
  var: '#f59e0b',
  let: '#3b82f6',
  const: '#10b981'
}
```

6. **Variable display:** Show each variable as a card with:
- Keyword badge (var/let/const) with keyword color
- Variable name
- Value (or "undefined" or "TDZ" based on state)
- State badge (hoisted, initialized, etc.) with state color

7. **Legend at bottom:** Same pattern as existing VariablesViz but with state indicators added.
  </action>
  <verify>
```bash
npx tsc --noEmit
```
Component renders with:
- Level selector (Beginner active, others disabled)
- Example tabs for 4 examples
- CodePanel from SharedViz with highlighted line
- Variables panel with animated variable cards
- StepControls working (Prev/Next/Reset)
  </verify>
  <done>
Core component renders with level selector, example tabs, SharedViz integration, and variable state visualization.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add CSS styling matching LoopsViz patterns</name>
  <files>src/components/Concepts/VariablesViz.module.css</files>
  <action>
Rewrite VariablesViz.module.css with styling matching LoopsViz patterns:

1. **CSS variables (local):**
```css
.container {
  --js-code-bg: rgba(30, 41, 59, 0.5);
  --js-code-border: rgba(148, 163, 184, 0.1);
  --js-highlight-bg: rgba(59, 130, 246, 0.15);
  --js-highlight-border: rgba(59, 130, 246, 0.3);
  --js-text-primary: #e2e8f0;
  --js-text-secondary: #94a3b8;
  --js-accent: #3b82f6;
}
```

2. **Level selector:**
- Horizontal pills with flex
- Each level pill has color dot and label
- Active state with glow and color
- Disabled state with opacity 0.5 and cursor not-allowed

3. **Example tabs:**
- Similar to LoopsViz: horizontal buttons with glow on active
- Underline or border-bottom for active tab

4. **Main grid:**
- Two columns on desktop, single column on mobile
- Gap between code and variables panels

5. **Neon box pattern (from HoistingViz/LoopsViz):**
```css
.neonBox {
  position: relative;
  border-radius: var(--radius-xl, 12px);
  padding: 3px;
  background: linear-gradient(135deg, var(--neon-start), var(--neon-end));
}

.neonBoxInner {
  background: var(--bg-page-secondary, #1e293b);
  border-radius: var(--radius-lg, 10px);
  padding: 1rem;
}
```

6. **Variable card styling:**
```css
.variable {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  background: rgba(30, 41, 59, 0.5);
  border-radius: 8px;
  border-left: 3px solid;
}

.varKeyword {
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  padding: 0.1rem 0.3rem;
  border-radius: 4px;
  background: rgba(255,255,255,0.1);
}

.varState {
  font-size: 0.65rem;
  padding: 0.1rem 0.4rem;
  border-radius: 10px;
  margin-left: auto;
}
```

7. **Controls, description, insight box:** Match LoopsViz patterns.

8. **Legend:** Same pattern as existing but add state indicators.

9. **Mobile responsiveness:** Stack panels vertically on narrow screens.
  </action>
  <verify>
```bash
npm run build
```
Build passes. Styling visually matches LoopsViz:
- Level selector with colored dots
- Example tabs with active glow
- Neon box panels
- Variable cards with state colors
- Responsive layout
  </verify>
  <done>
CSS styling complete with local variables, neon box pattern, variable cards, and mobile responsiveness.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **TypeScript compiles:** `npx tsc --noEmit`
2. **Build passes:** `npm run build`
3. **Component renders:** Navigate to /concepts/variables
4. **Level selector:** Beginner active, Intermediate/Advanced disabled
5. **Example tabs:** 4 tabs visible, switching resets step
6. **Step through:** All 4 examples can be stepped through completely
7. **SharedViz integration:** CodePanel highlights line, StepControls work
8. **Variable visualization:** Cards show keyword, name, value, state with colors
</verification>

<success_criteria>
- [ ] VariablesViz renders with level selector and 4 beginner example tabs
- [ ] Each example can be stepped through forward and backward
- [ ] Code highlighting syncs with current step
- [ ] Variables panel shows variable cards with state colors
- [ ] CSS matches LoopsViz visual patterns
- [ ] TypeScript compiles, build passes
</success_criteria>

<output>
After completion, create `.planning/phases/03-variablesviz/03-01-SUMMARY.md`
</output>
