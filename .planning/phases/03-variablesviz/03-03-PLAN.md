---
phase: 03-variablesviz
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/components/Concepts/VariablesViz.tsx
  - src/components/Concepts/VariablesViz.module.css
autonomous: true

must_haves:
  truths:
    - "User can select Advanced level with 4 examples"
    - "TDZ error example stops execution and shows ReferenceError"
    - "const reassignment error shows TypeError"
    - "Hoisting animation shows var floating up during creation phase"
    - "Phase badge shows Creation Phase vs Execution Phase"
  artifacts:
    - path: "src/components/Concepts/VariablesViz.tsx"
      provides: "Advanced examples with error states and hoisting animation"
      contains: "hoistingAnimation"
    - path: "src/components/Concepts/VariablesViz.module.css"
      provides: "Error panel and hoisting animation styling"
      contains: "errorPanel"
  key_links:
    - from: "src/components/Concepts/VariablesViz.tsx"
      to: "error visualization"
      via: "error field in step data"
      pattern: "currentStep.error"
---

<objective>
Add advanced examples with error states, hoisting animation, and phase badge.

Purpose: Complete VariablesViz with advanced error scenarios (TDZ, const reassignment) and the hoisting animation showing var declarations "floating up" during creation phase. This addresses all 4 success criteria from the roadmap.

Output: VariablesViz with all 12 examples (4 per level), error panel, hoisting animation, and phase badge.
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-variablesviz/03-CONTEXT.md
@.planning/phases/03-variablesviz/03-RESEARCH.md
@.planning/phases/03-variablesviz/03-02-SUMMARY.md
@src/components/Concepts/VariablesViz.tsx
@src/components/Concepts/HoistingViz.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add 4 advanced examples with error states</name>
  <files>src/components/Concepts/VariablesViz.tsx</files>
  <action>
Add advanced level examples with error states. Enable Advanced level in the level selector.

Add hoistingAnimation field to VariableStep interface:
```typescript
interface VariableStep {
  // ... existing fields
  hoistingAnimation?: {
    variableName: string
    keyword: 'var' | 'let' | 'const'
    fromLine: number
    toPosition: 'top'  // Conceptual "top of scope"
  }
}
```

Create 4 advanced examples:

1. **tdz-error** (~6 steps): Accessing let before initialization
   - Code:
     ```javascript
     console.log(x);  // ReferenceError!
     let x = 5;
     ```
   - Creation phase: let x is hoisted in TDZ (state: hoisted-tdz)
   - Execution phase: Access attempt on line 1 causes error
   - Step with error:
     ```typescript
     {
       id: 2,
       description: 'Trying to access x throws ReferenceError - x is in the Temporal Dead Zone!',
       phase: 'execution',
       action: 'error',
       variables: [{ name: 'x', keyword: 'let', value: undefined, state: 'hoisted-tdz', scope: 'global', scopeLevel: 0 }],
       output: [],
       error: "ReferenceError: Cannot access 'x' before initialization"
     }
     ```
   - No more steps after error (execution stops)

2. **const-reassignment-error** (~5 steps): Reassigning const
   - Code:
     ```javascript
     const pi = 3.14;
     pi = 3.14159;  // TypeError!
     ```
   - const initialized normally
   - Reassignment attempt causes error:
     ```typescript
     error: "TypeError: Assignment to constant variable"
     ```

3. **var-redeclaration** (~6 steps): Multiple var declarations (no error)
   - Code:
     ```javascript
     var x = 1;
     console.log(x);  // 1
     var x = 2;       // No error! var allows redeclaration
     console.log(x);  // 2
     ```
   - Show both declarations working
   - Contrast: "With let, this would be a SyntaxError"
   - No actual error in this example

4. **hoisting-comparison** (~10 steps): var vs let hoisting with animation
   - Code:
     ```javascript
     // Creation Phase (hoisting happens here)
     // var a -> undefined
     // let b -> TDZ

     console.log(a);  // undefined
     // console.log(b);  // Would be ReferenceError

     var a = 1;
     let b = 2;
     ```
   - Creation phase steps show hoisting with animation:
     ```typescript
     {
       id: 1,
       description: 'var a is hoisted to the top of scope with value undefined',
       phase: 'creation',
       action: 'hoist',
       variables: [{ name: 'a', keyword: 'var', value: 'undefined', state: 'hoisted-undefined', ... }],
       hoistingAnimation: { variableName: 'a', keyword: 'var', fromLine: 6, toPosition: 'top' },
       output: []
     }
     ```
   - Show var hoisted with undefined, let hoisted in TDZ
   - Execution phase shows access working for var but would fail for let
  </action>
  <verify>
File contains:
- `advanced:` array with 4 examples
- At least 2 examples have steps with error field
- At least 1 example has hoistingAnimation field in steps
- Level selector logic enables Advanced
  </verify>
  <done>
4 advanced examples with error states and hoisting animation data ready for rendering.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build error panel and phase badge</name>
  <files>src/components/Concepts/VariablesViz.tsx</files>
  <action>
Add error panel and phase badge components.

1. **Phase badge (in code panel header):**
```typescript
// Add to code panel header
<div className={styles.panelHeader}>
  <span>Code</span>
  <span
    className={styles.phaseBadge}
    style={{
      background: currentStep.phase === 'creation' ? '#60a5fa' : '#10b981'
    }}
  >
    {currentStep.phase === 'creation' ? 'Creation' : 'Execution'} Phase
  </span>
</div>
```

2. **Error panel (conditional rendering):**
```typescript
{currentStep.error && (
  <motion.div
    className={styles.errorPanel}
    initial={{ opacity: 0, scale: 0.95 }}
    animate={{ opacity: 1, scale: 1 }}
    transition={{ duration: 0.3 }}
  >
    <div className={styles.errorIcon}>!</div>
    <div className={styles.errorType}>
      {currentStep.error.includes('ReferenceError') ? 'ReferenceError' : 'TypeError'}
    </div>
    <div className={styles.errorMessage}>
      {currentStep.error}
    </div>
    <div className={styles.errorHint}>
      {currentStep.error.includes('before initialization')
        ? 'Variable is in the Temporal Dead Zone (TDZ)'
        : currentStep.error.includes('constant')
          ? 'const bindings cannot be reassigned'
          : ''
      }
    </div>
  </motion.div>
)}
```

3. **Disable Next button on error:**
When step has error, it's the final step for that example.
```typescript
const isAtEnd = stepIndex >= currentExample.steps.length - 1 || currentStep.error
```

4. **Update variables panel header to show creation phase indicator:**
When in creation phase, variables panel header could show "Variable Environment (Creating...)"
  </action>
  <verify>
Navigate to /concepts/variables, select Advanced, select tdz-error:
- Phase badge shows "Creation Phase" then "Execution Phase"
- Error panel appears when error step reached
- Error panel shows error type, message, and hint
- Next button disabled after error step
  </verify>
  <done>
Error panel renders with styled error display, phase badge shows current phase.
  </done>
</task>

<task type="auto">
  <name>Task 3: Build hoisting animation and add CSS</name>
  <files>src/components/Concepts/VariablesViz.tsx, src/components/Concepts/VariablesViz.module.css</files>
  <action>
Add hoisting animation visualization and complete CSS styling.

**In VariablesViz.tsx:**

1. **Hoisting animation panel:**
When step has hoistingAnimation, show a visual of the variable "floating up":
```typescript
{currentStep.hoistingAnimation && (
  <motion.div
    className={styles.hoistingAnimation}
    key={`hoist-${currentStep.id}-${currentStep.hoistingAnimation.variableName}`}
    initial={{ y: 50, opacity: 0 }}
    animate={{ y: 0, opacity: 1 }}
    transition={{
      duration: 0.8,
      ease: "easeOut"
    }}
  >
    <div className={styles.hoistingLabel}>Hoisting to top of scope</div>
    <div className={styles.hoistingVar}>
      <span style={{ color: keywordColors[currentStep.hoistingAnimation.keyword] }}>
        {currentStep.hoistingAnimation.keyword}
      </span>
      {' '}{currentStep.hoistingAnimation.variableName} ={' '}
      <span className={styles.hoistingValue}>
        {currentStep.hoistingAnimation.keyword === 'var' ? 'undefined' : 'TDZ'}
      </span>
    </div>
    <motion.div
      className={styles.hoistingArrow}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      transition={{ delay: 0.3 }}
    >
      â†‘
    </motion.div>
  </motion.div>
)}
```

2. **Position the animation:**
The hoisting animation appears above or beside the code panel to show the "floating up" concept.

**In VariablesViz.module.css:**

3. **Error panel styling:**
```css
.errorPanel {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05));
  border: 2px solid rgba(239, 68, 68, 0.5);
  border-radius: 12px;
  padding: 1.5rem;
  text-align: center;
  margin-top: 1rem;
}

.errorIcon {
  width: 40px;
  height: 40px;
  background: #ef4444;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: bold;
  color: white;
  margin: 0 auto 0.75rem;
}

.errorType {
  font-size: 1.1rem;
  font-weight: 600;
  color: #ef4444;
  margin-bottom: 0.5rem;
}

.errorMessage {
  font-family: var(--font-mono, monospace);
  font-size: 0.9rem;
  color: var(--js-text-primary);
  background: rgba(0, 0, 0, 0.3);
  padding: 0.5rem 1rem;
  border-radius: 6px;
  display: inline-block;
  margin-bottom: 0.5rem;
}

.errorHint {
  font-size: 0.8rem;
  color: var(--js-text-secondary);
  font-style: italic;
}
```

4. **Phase badge styling:**
```css
.phaseBadge {
  font-size: 0.7rem;
  font-weight: 600;
  padding: 0.2rem 0.6rem;
  border-radius: 12px;
  color: white;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
```

5. **Hoisting animation styling:**
```css
.hoistingAnimation {
  background: rgba(245, 158, 11, 0.1);
  border: 2px dashed rgba(245, 158, 11, 0.5);
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 0.5rem;
  text-align: center;
}

.hoistingLabel {
  font-size: 0.75rem;
  color: #f59e0b;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.5rem;
}

.hoistingVar {
  font-family: var(--font-mono, monospace);
  font-size: 0.9rem;
  color: var(--js-text-primary);
  background: rgba(0, 0, 0, 0.3);
  padding: 0.5rem 1rem;
  border-radius: 6px;
  display: inline-block;
}

.hoistingValue {
  color: #f59e0b;
}

.hoistingArrow {
  font-size: 1.5rem;
  color: #f59e0b;
  margin-top: 0.5rem;
  animation: float 1s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}
```

6. **Update legend:**
Add TDZ indicator to legend:
```css
/* In the component, add TDZ legend item */
```
  </action>
  <verify>
```bash
npm run build
```
Navigate to /concepts/variables, Advanced level, hoisting-comparison example:
- Hoisting animation panel appears during creation phase steps
- Arrow animates floating upward
- var shows "undefined", let shows "TDZ" in animation
- Error panel appears on error steps with proper styling
- Phase badge toggles between Creation (blue) and Execution (green)
  </verify>
  <done>
Hoisting animation visualizes var floating up, error panel displays errors with hints, phase badge shows current execution phase.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **TypeScript compiles:** `npx tsc --noEmit`
2. **Build passes:** `npm run build`
3. **All levels enabled:** Beginner, Intermediate, Advanced all selectable
4. **12 total examples:** 4 per level
5. **Phase badge:** Shows Creation/Execution phase
6. **TDZ error:** Example stops on error, shows ReferenceError panel
7. **const error:** Shows TypeError panel
8. **Hoisting animation:** var "floats up" with arrow animation
9. **Error hint:** Explains TDZ and const restriction

**Roadmap Success Criteria Check:**
- [x] Hoisting visualization shows declaration phase separate from initialization phase (phase badge + hoisting animation)
- [x] TDZ step-through shows let/const variables existing but inaccessible (advanced TDZ error example)
- [x] Scope chain visualization shows variable lookup traversing nested scopes (intermediate examples)
- [x] Block scope vs function scope examples demonstrate var escaping blocks (intermediate function-vs-block-scope example)
</verification>

<success_criteria>
- [ ] Advanced level enabled with 4 examples
- [ ] Error panel renders for TDZ and const reassignment errors
- [ ] Hoisting animation shows var floating up during creation phase
- [ ] Phase badge shows Creation vs Execution phase
- [ ] All 12 examples (4 per level) steppable
- [ ] All 4 roadmap success criteria addressed
- [ ] TypeScript compiles, build passes
</success_criteria>

<output>
After completion, create `.planning/phases/03-variablesviz/03-03-SUMMARY.md`
</output>
