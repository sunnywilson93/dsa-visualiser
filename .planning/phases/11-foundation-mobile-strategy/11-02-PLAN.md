---
phase: 11-foundation-mobile-strategy
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/getCrossLinks.ts
autonomous: true

must_haves:
  truths:
    - "getRelatedPatterns returns pattern links for a given problem ID"
    - "getRelatedProblems returns problem links for a given pattern ID"
    - "getCrossLinks provides unified interface for both directions"
    - "Functions handle missing/unknown IDs gracefully (return empty array)"
  artifacts:
    - path: "src/utils/getCrossLinks.ts"
      provides: "Cross-link utility functions"
      exports: ["CrossLink", "getRelatedPatterns", "getRelatedProblems", "getCrossLinks"]
      min_lines: 50
  key_links:
    - from: "src/utils/getCrossLinks.ts"
      to: "src/data/dsaPatterns.ts"
      via: "import dsaPatterns"
      pattern: "import.*dsaPatterns"
    - from: "src/utils/getCrossLinks.ts"
      to: "src/data/algorithmConcepts.ts"
      via: "import problemConcepts"
      pattern: "import.*problemConcepts"
---

<objective>
Create cross-link utility functions for pattern-problem relationships.

Purpose: Phase 13 (Cross-Linking) will use these utilities to render "Practice this pattern" and "Learn the pattern" sections. Building utilities now keeps Phase 13 focused on UI components.

Output:
- getCrossLinks.ts with getRelatedPatterns, getRelatedProblems, getCrossLinks functions
- CrossLink type for consistent link structure
</objective>

<execution_context>
@/Users/sunnywilson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunnywilson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-foundation-mobile-strategy/11-RESEARCH.md

@src/data/dsaPatterns.ts
@src/data/algorithmConcepts.ts
@src/data/examples.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create cross-link utility module</name>
  <files>src/utils/getCrossLinks.ts</files>
  <action>
Create src/utils directory if needed, then create getCrossLinks.ts with cross-linking utilities.

**Analysis of existing data structures (VERIFIED):**

1. `dsaPatterns` (from dsaPatterns.ts):
   - Has `id`: 'two-pointers', 'hash-map', 'bit-manipulation'
   - Has `name`, `slug`, `description`
   - Has `relatedProblems?: string[]` with problem IDs

2. `problemConcepts` (from algorithmConcepts.ts):
   - Record<string, ProblemConcept>
   - Each ProblemConcept has `pattern: ConceptType`
   - ConceptType values: 'two-pointers-converge', 'two-pointers-same-dir', 'two-pointers-partition', 'bit-manipulation', etc.

3. `codeExamples` (from examples.ts):
   - Array of problems with `id`, `name`, `category`, `description`

**Pattern ID Mapping (VERIFIED):**
The pattern extraction `pattern.split('-').slice(0, 2).join('-')` correctly maps:
- 'two-pointers-converge' -> 'two-pointers' (matches dsaPatterns id)
- 'two-pointers-same-dir' -> 'two-pointers' (matches dsaPatterns id)
- 'two-pointers-partition' -> 'two-pointers' (matches dsaPatterns id)
- 'bit-manipulation' -> 'bit-manipulation' (matches dsaPatterns id, only 2 parts)

**URL Pattern (VERIFIED from codebase):**
- Pattern pages: `/concepts/dsa/patterns/${pattern.slug}`
- Problem pages: `/${problem.category}/${problem.id}`

**Create src/utils/getCrossLinks.ts:**

```typescript
import { dsaPatterns } from '@/data/dsaPatterns'
import { problemConcepts } from '@/data/algorithmConcepts'
import { codeExamples } from '@/data/examples'

export interface CrossLink {
  type: 'pattern' | 'problem'
  id: string
  name: string
  href: string
  description?: string
}

/**
 * Get related patterns for a problem
 * Uses problemConcepts to find which pattern a problem belongs to
 */
export function getRelatedPatterns(problemId: string): CrossLink[] {
  const concept = problemConcepts[problemId]
  if (!concept) return []

  // Extract base pattern from concept.pattern (e.g., 'two-pointers-converge' -> 'two-pointers')
  const patternBase = concept.pattern.split('-').slice(0, 2).join('-')

  // Find matching patterns
  return dsaPatterns
    .filter(pattern =>
      pattern.id === patternBase ||
      concept.pattern.startsWith(pattern.id) ||
      pattern.relatedProblems?.includes(problemId)
    )
    .map(pattern => ({
      type: 'pattern' as const,
      id: pattern.id,
      name: pattern.name,
      href: `/concepts/dsa/patterns/${pattern.slug}`,
      description: pattern.description,
    }))
}

/**
 * Get related problems for a pattern
 * Uses both explicit relatedProblems and problemConcepts pattern matching
 */
export function getRelatedProblems(patternId: string): CrossLink[] {
  const pattern = dsaPatterns.find(p => p.id === patternId)
  if (!pattern) return []

  // Find problems that use this pattern via problemConcepts
  const problemsByPattern = Object.entries(problemConcepts)
    .filter(([_, concept]) => concept.pattern.startsWith(patternId))
    .map(([id]) => id)

  // Combine with explicitly listed related problems
  const allRelatedIds = new Set([
    ...problemsByPattern,
    ...(pattern.relatedProblems || [])
  ])

  return Array.from(allRelatedIds)
    .map(problemId => {
      const problem = codeExamples.find(p => p.id === problemId)
      if (!problem) return null

      return {
        type: 'problem' as const,
        id: problem.id,
        name: problem.name,
        href: `/${problem.category}/${problem.id}`,
        description: problem.description,
      }
    })
    .filter((link): link is CrossLink => link !== null)
}

/**
 * Unified cross-link getter for any context
 */
export function getCrossLinks(
  context: { type: 'problem' | 'pattern'; id: string }
): { patterns: CrossLink[]; problems: CrossLink[] } {
  if (context.type === 'problem') {
    return {
      patterns: getRelatedPatterns(context.id),
      problems: [],
    }
  }

  return {
    patterns: [],
    problems: getRelatedProblems(context.id),
  }
}
```

Key implementation notes:
- Pattern matching extracts base pattern ID from concept.pattern (handles 'two-pointers-converge' -> 'two-pointers')
- Uses both explicit relatedProblems AND derived relationships from problemConcepts
- Returns empty arrays for unknown IDs (graceful handling)
- href generation uses verified URL patterns from the project
  </action>
  <verify>
1. mkdir -p src/utils (ensure directory exists)
2. cat src/utils/getCrossLinks.ts (verify file contents)
3. Check imports resolve: npm run build
4. Verify pattern mapping logic works (confirm data shapes in dsaPatterns.ts and algorithmConcepts.ts match implementation)
  </verify>
  <done>getCrossLinks.ts exports CrossLink type and three functions: getRelatedPatterns, getRelatedProblems, getCrossLinks</done>
</task>

<task type="auto">
  <name>Task 2: Verify cross-link functions with runtime tests</name>
  <files>src/utils/getCrossLinks.ts</files>
  <action>
Verify the cross-link functions work correctly by testing with known data.

**Runtime verification using Node.js evaluation:**

After creating the module, verify with actual data by running a quick test script:

```bash
# Create temporary test file
cat > /tmp/test-crosslinks.mjs << 'EOF'
// Test the cross-link functions against real data
import { dsaPatterns } from './src/data/dsaPatterns.ts'
import { problemConcepts } from './src/data/algorithmConcepts.ts'
import { codeExamples } from './src/data/examples.ts'

// Test data relationships manually (no imports from the util yet, just verify data)
console.log('=== Data Verification ===')

// 1. Verify dsaPatterns structure
console.log('dsaPatterns IDs:', dsaPatterns.map(p => p.id))

// 2. Verify problemConcepts for two-sum-ii
const twoSumConcept = problemConcepts['two-sum-ii']
console.log('two-sum-ii pattern:', twoSumConcept?.pattern)
console.log('Expected base:', twoSumConcept?.pattern.split('-').slice(0, 2).join('-'))

// 3. Verify two-pointers has relatedProblems
const twoPointers = dsaPatterns.find(p => p.id === 'two-pointers')
console.log('two-pointers relatedProblems:', twoPointers?.relatedProblems)

// 4. Verify codeExamples has matching problems
const twoSumProblem = codeExamples.find(p => p.id === 'two-sum')
console.log('two-sum category:', twoSumProblem?.category)
EOF
```

Then build and verify TypeScript compiles:
```bash
npx tsc --noEmit
npm run build
```

**Expected results to verify:**
- getRelatedPatterns('two-sum-ii') returns links with pattern 'two-pointers'
- getRelatedPatterns('single-number') returns links with pattern 'bit-manipulation'
- getRelatedProblems('two-pointers') returns links including 'two-sum', 'three-sum', etc.
- getRelatedProblems('bit-manipulation') returns links including 'single-number', 'counting-bits'
- getRelatedPatterns('unknown-problem') returns []
- getRelatedProblems('unknown-pattern') returns []

**Verify href format matches project URL patterns:**
- Pattern hrefs: `/concepts/dsa/patterns/{slug}` (e.g., `/concepts/dsa/patterns/two-pointers`)
- Problem hrefs: `/{category}/{id}` (e.g., `/arrays-hashing/two-sum`)
  </action>
  <verify>
1. npm run build succeeds
2. npx tsc --noEmit passes
3. grep "export function" src/utils/getCrossLinks.ts shows all three functions
4. Verify data relationships manually:
   - grep "two-sum-ii" src/data/algorithmConcepts.ts | grep "pattern" (should show 'two-pointers-converge')
   - grep "relatedProblems" src/data/dsaPatterns.ts (should show problem IDs)
5. Verify href patterns in generated code:
   - grep "concepts/dsa/patterns" src/utils/getCrossLinks.ts (should exist)
   - grep "category.*id" src/utils/getCrossLinks.ts (should build problem hrefs correctly)
  </verify>
  <done>Cross-link utilities compile, build successfully, and data relationships verified against real project data. Pattern mapping correctly derives 'two-pointers' from 'two-pointers-converge'. Href formats match project URL patterns.</done>
</task>

</tasks>

<verification>
1. npm run build completes without errors
2. npm run lint passes
3. src/utils/getCrossLinks.ts exports CrossLink, getRelatedPatterns, getRelatedProblems, getCrossLinks
4. Imports from @/data/ resolve correctly
5. Pattern extraction logic verified: 'two-pointers-converge' -> 'two-pointers'
6. Href formats verified: `/concepts/dsa/patterns/{slug}` and `/{category}/{id}`
</verification>

<success_criteria>
- getCrossLinks.ts exists in src/utils/
- Exports CrossLink interface with type, id, name, href, description fields
- getRelatedPatterns(problemId) returns pattern links or empty array
- getRelatedProblems(patternId) returns problem links or empty array
- getCrossLinks(context) provides unified interface
- Pattern ID mapping verified against actual ConceptType values
- Href generation matches project URL patterns
- Build and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/11-foundation-mobile-strategy/11-02-SUMMARY.md`
</output>
