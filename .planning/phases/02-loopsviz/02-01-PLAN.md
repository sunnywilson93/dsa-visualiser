---
phase: 02-loopsviz
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Concepts/LoopsViz.tsx
  - src/components/Concepts/LoopsViz.module.css
autonomous: true

must_haves:
  truths:
    - "User can select beginner level and see 4 loop examples"
    - "User can step forward and backward through any example"
    - "Each step shows an explanation of what the loop is doing"
    - "Current code line highlights in sync with current step"
    - "Loop state panel shows iteration count, variable value, and condition"
    - "Output panel shows console output with current line highlighted"
  artifacts:
    - path: "src/components/Concepts/LoopsViz.tsx"
      provides: "Complete LoopsViz component with step-through navigation"
      contains: "Level.*beginner"
    - path: "src/components/Concepts/LoopsViz.module.css"
      provides: "Styling matching EventLoopViz patterns"
      contains: "levelSelector"
  key_links:
    - from: "src/components/Concepts/LoopsViz.tsx"
      to: "@/components/SharedViz"
      via: "import statement"
      pattern: "import.*SharedViz"
    - from: "src/components/Concepts/LoopsViz.tsx"
      to: "stepIndex state"
      via: "StepControls integration"
      pattern: "setStepIndex"
---

<objective>
Rewrite LoopsViz as a step-through visualization following the EventLoopViz gold standard pattern. This plan creates the complete component structure with beginner-level examples (basic for loop, while loop, for...of array, for...in object).

Purpose: Transform the simple auto-play loop animation into an interactive step-through learning experience where users control the pace and see exactly what happens at each phase of loop execution.

Output: Working LoopsViz component with level selector, example selector, step controls, loop state visualization, and 4 beginner examples demonstrating basic loop types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-loopsviz/02-CONTEXT.md
@.planning/phases/02-loopsviz/02-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@src/components/SharedViz/index.ts
@src/components/Concepts/EventLoopViz.tsx (pattern reference - level selector, example selector, state management)
@src/components/Concepts/LoopsViz.tsx (current implementation to replace)
@src/components/Concepts/LoopsViz.module.css (current CSS to replace)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LoopsViz types and beginner example data</name>
  <files>src/components/Concepts/LoopsViz.tsx</files>
  <action>
Start fresh LoopsViz.tsx (complete rewrite). Define:

1. **Types** (at top of file):
```typescript
type Level = 'beginner' | 'intermediate' | 'advanced'
type LoopPhase = 'init' | 'condition' | 'body' | 'update' | 'done'

interface LoopStep {
  id: number
  codeLine: number           // -1 for no highlight
  description: string        // Educational explanation
  phase: LoopPhase
  loopState: {
    iteration: number        // Current iteration (0-indexed)
    variable: string         // Loop variable name (i, item, key)
    value: number | string   // Current value
    condition: string        // e.g., "i < 3"
    conditionMet: boolean
  }
  output: string[]           // Accumulated console output
  currentOutputIndex?: number // Which output line was just added (-1 or undefined for none)
}

interface LoopExample {
  id: string
  title: string
  loopType: 'for' | 'while' | 'do-while' | 'for-of' | 'for-in'
  code: string[]             // Code lines as array
  steps: LoopStep[]
  insight: string            // Key takeaway
  whyItMatters?: string      // Educational context for beginners
}
```

2. **Level info** (copy pattern from EventLoopViz):
```typescript
const levelInfo: Record<Level, { label: string; color: string }> = {
  beginner: { label: 'Beginner', color: '#10b981' },
  intermediate: { label: 'Intermediate', color: '#f59e0b' },
  advanced: { label: 'Advanced', color: '#ef4444' }
}
```

3. **Beginner examples** (4 total):

**Example 1: Basic for loop**
```javascript
const fruits = ['apple', 'banana', 'cherry']

for (let i = 0; i < fruits.length; i++) {
  console.log(fruits[i])
}
```
Steps: init (i=0) -> condition (true) -> body (logs apple) -> update (i=1) -> condition (true) -> body (logs banana) -> update (i=2) -> condition (true) -> body (logs cherry) -> update (i=3) -> condition (false) -> done

**Example 2: while loop**
```javascript
const fruits = ['apple', 'banana', 'cherry']
let i = 0

while (i < fruits.length) {
  console.log(fruits[i])
  i++
}
```
Steps: Similar pattern, show condition check before body

**Example 3: for...of array**
```javascript
const fruits = ['apple', 'banana', 'cherry']

for (const fruit of fruits) {
  console.log(fruit)
}
```
Steps: Show each iteration getting the value directly (no index)

**Example 4: for...in object**
```javascript
const person = { name: 'Alice', age: 25, city: 'NYC' }

for (const key in person) {
  console.log(key, person[key])
}
```
Steps: Show iteration over keys, accessing values

For each example, craft 8-12 steps that explicitly show:
- Loop initialization
- Condition check (ALWAYS explicit before entering body)
- Body execution
- Variable update
- Final condition check that fails
- Loop completion

Beginner descriptions should be verbose and include "why this matters" context:
- "The loop initializes i to 0. This variable will track which element we're on."
- "Condition check: is 0 < 3? Yes! Since the condition is true, we enter the loop body."
- "The loop body executes console.log(fruits[0]), which outputs 'apple'."

Store examples in: `const examples: Record<Level, LoopExample[]>`
Set intermediate and advanced to empty arrays for now: `intermediate: [], advanced: []`
  </action>
  <verify>File compiles with `npx tsc --noEmit` - no type errors in the types and data definitions</verify>
  <done>LoopStep, LoopExample interfaces defined; levelInfo constant defined; 4 beginner examples with complete step data defined; examples Record structure in place</done>
</task>

<task type="auto">
  <name>Task 2: Implement LoopsViz component with SharedViz integration</name>
  <files>src/components/Concepts/LoopsViz.tsx</files>
  <action>
Add the React component to LoopsViz.tsx (below the types and data):

1. **Imports:**
```typescript
import { useState } from 'react'
import { motion, AnimatePresence } from 'framer-motion'
import { CodePanel, StepProgress, StepControls } from '@/components/SharedViz'
import styles from './LoopsViz.module.css'
```

2. **State management** (follow EventLoopViz pattern):
```typescript
const [level, setLevel] = useState<Level>('beginner')
const [exampleIndex, setExampleIndex] = useState(0)
const [stepIndex, setStepIndex] = useState(0)

// Derived state
const currentExamples = examples[level]
const currentExample = currentExamples[exampleIndex]
const currentStep = currentExample.steps[stepIndex]

// Reset handlers (cascade down)
const handleLevelChange = (newLevel: Level) => {
  setLevel(newLevel)
  setExampleIndex(0)
  setStepIndex(0)
}

const handleExampleChange = (index: number) => {
  setExampleIndex(index)
  setStepIndex(0)
}
```

3. **Component structure:**
```tsx
<div className={styles.container}>
  {/* Level selector - pill buttons */}
  <div className={styles.levelSelector}>
    {(Object.keys(levelInfo) as Level[]).map(lvl => (
      <button
        key={lvl}
        className={`${styles.levelBtn} ${level === lvl ? styles.activeLevel : ''}`}
        onClick={() => handleLevelChange(lvl)}
        disabled={examples[lvl].length === 0}
        style={{...}}
      >
        <span className={styles.levelDot} style={{ background: levelInfo[lvl].color }} />
        {levelInfo[lvl].label}
      </button>
    ))}
  </div>

  {/* Example selector tabs */}
  <div className={styles.exampleTabs}>
    {currentExamples.map((ex, i) => (
      <button
        key={ex.id}
        className={`${styles.exampleTab} ${exampleIndex === i ? styles.activeTab : ''}`}
        onClick={() => handleExampleChange(i)}
      >
        {ex.title}
      </button>
    ))}
  </div>

  <div className={styles.mainGrid}>
    {/* Left: Code panel using SharedViz CodePanel */}
    <CodePanel
      code={currentExample.code}
      highlightedLine={currentStep.codeLine}
      title="Code"
    />

    {/* Right: Loop state visualization */}
    <div className={styles.loopStateBox}>
      <div className={styles.boxHeader}>Loop State</div>
      <div className={styles.boxContent}>
        <div className={styles.stateRow}>
          <span className={styles.stateLabel}>Iteration:</span>
          <motion.span key={currentStep.loopState.iteration} className={styles.stateValue}>
            {currentStep.loopState.iteration}
          </motion.span>
        </div>
        <div className={styles.stateRow}>
          <span className={styles.stateLabel}>{currentStep.loopState.variable}:</span>
          <motion.span key={String(currentStep.loopState.value)} className={styles.stateValue}>
            {currentStep.loopState.value}
          </motion.span>
        </div>
        <div className={styles.conditionRow}>
          <span className={`${styles.condition} ${currentStep.loopState.conditionMet ? styles.conditionTrue : styles.conditionFalse}`}>
            {currentStep.loopState.condition} = {currentStep.loopState.conditionMet ? 'true' : 'false'}
          </span>
        </div>
      </div>
    </div>
  </div>

  {/* Output panel */}
  <div className={styles.outputBox}>
    <div className={styles.boxHeader}>Console Output</div>
    <div className={styles.outputContent}>
      <AnimatePresence>
        {currentStep.output.map((line, i) => (
          <motion.div
            key={i}
            className={`${styles.outputLine} ${i === currentStep.currentOutputIndex ? styles.currentOutput : ''}`}
            initial={i === currentStep.currentOutputIndex ? { opacity: 0, x: -10 } : undefined}
            animate={{ opacity: 1, x: 0 }}
          >
            {line}
          </motion.div>
        ))}
      </AnimatePresence>
    </div>
  </div>

  {/* Step progress and description */}
  <StepProgress
    current={stepIndex}
    total={currentExample.steps.length}
    description={currentStep.description}
  />

  {/* Step controls */}
  <StepControls
    onPrev={() => setStepIndex(s => s - 1)}
    onNext={() => setStepIndex(s => s + 1)}
    onReset={() => setStepIndex(0)}
    canPrev={stepIndex > 0}
    canNext={stepIndex < currentExample.steps.length - 1}
  />

  {/* Insight box */}
  <div className={styles.insightBox}>
    <span className={styles.insightLabel}>Key Insight:</span>
    {currentExample.insight}
  </div>
</div>
```

4. **Export:**
```typescript
export function LoopsViz() { ... }
```

Do NOT include auto-play functionality (LOOP-01 requirement: step controls only, no auto-play).
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`. Imports resolve correctly.</verify>
  <done>LoopsViz component renders with level selector, example tabs, CodePanel, loop state panel, output panel, StepProgress, StepControls, and insight box</done>
</task>

<task type="auto">
  <name>Task 3: Complete CSS styling matching EventLoopViz patterns</name>
  <files>src/components/Concepts/LoopsViz.module.css</files>
  <action>
Complete rewrite of LoopsViz.module.css. Reference EventLoopViz.module.css for consistent styling.

Define CSS variables locally (same pattern as SharedViz components):
```css
.container {
  --js-viz-bg: #0d1117;
  --js-viz-border: rgba(255, 255, 255, 0.08);
  --js-viz-accent: #10b981;
}
```

Include styles for:

1. **Container** - flex column with gap

2. **Level selector** - horizontal pill buttons
```css
.levelSelector {
  display: flex;
  gap: var(--space-sm);
  justify-content: center;
  flex-wrap: wrap;
}

.levelBtn {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  padding: var(--space-sm) var(--space-lg);
  font-family: 'Fira Code', monospace;
  font-size: var(--text-sm);
  background: transparent;
  border: 2px solid transparent;
  border-radius: var(--radius-lg);
  color: var(--gray-500);
  cursor: pointer;
  transition: all 0.2s;
}

.levelBtn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.levelBtn.activeLevel {
  color: var(--color-white);
}

.levelDot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}
```

3. **Example tabs** - horizontal scrollable tabs

4. **Main grid** - 2-column layout (code left, loop state right)

5. **Loop state box** - neonBox pattern from EventLoopViz
```css
.loopStateBox {
  background: rgba(0, 0, 0, 0.4);
  border: 1px solid var(--js-viz-border);
  border-radius: var(--radius-xl);
  overflow: hidden;
}

.boxHeader {
  padding: var(--space-sm) var(--space-md);
  font-size: var(--text-xs);
  font-weight: var(--font-semibold);
  color: var(--gray-500);
  background: rgba(255, 255, 255, 0.05);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.boxContent {
  padding: var(--space-md);
}

.stateRow {
  display: flex;
  justify-content: space-between;
  padding: var(--space-xs) 0;
}

.stateLabel {
  color: var(--gray-500);
  font-family: 'Fira Code', monospace;
  font-size: var(--text-sm);
}

.stateValue {
  color: var(--difficulty-1);
  font-family: 'Fira Code', monospace;
  font-size: var(--text-sm);
  font-weight: var(--font-semibold);
}

.conditionRow {
  margin-top: var(--space-sm);
  padding-top: var(--space-sm);
  border-top: 1px solid var(--js-viz-border);
}

.condition {
  font-family: 'Fira Code', monospace;
  font-size: var(--text-sm);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--radius-md);
}

.conditionTrue {
  background: rgba(16, 185, 129, 0.15);
  color: #10b981;
}

.conditionFalse {
  background: rgba(239, 68, 68, 0.15);
  color: #ef4444;
}
```

6. **Output box** - similar to loop state box, with current output highlight
```css
.currentOutput {
  background: rgba(16, 185, 129, 0.1);
  border-left: 2px solid #10b981;
  padding-left: var(--space-sm);
}
```

7. **Insight box** - subtle highlight for key takeaway

8. **Mobile responsive** - stack to single column on small screens

Reference EventLoopViz.module.css for exact spacing, colors, and animation patterns to maintain visual consistency across concept pages.
  </action>
  <verify>Dev server runs without CSS errors: `npm run dev`. Visual inspection shows proper styling.</verify>
  <done>CSS matches EventLoopViz visual style - level selector pills, neon box panels, condition true/false colors, output highlighting, mobile responsive</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run dev` - dev server starts without errors
2. Navigate to /concepts/loops (or wherever LoopsViz is rendered)
3. Verify level selector shows Beginner (enabled), Intermediate (disabled), Advanced (disabled)
4. Verify 4 example tabs appear for beginner level
5. Click through all steps of "Basic for loop" example
6. Verify code highlighting moves with steps
7. Verify loop state panel updates (iteration, variable value, condition)
8. Verify output panel shows cumulative output with current line highlighted
9. Verify Prev/Next/Reset controls work correctly
10. `npm run lint` passes
</verification>

<success_criteria>
- [ ] LoopsViz component completely rewritten (not patched)
- [ ] Level selector with beginner enabled, intermediate/advanced disabled
- [ ] 4 beginner examples with complete step-through data
- [ ] Each step shows educational explanation
- [ ] Code highlighting syncs with current step
- [ ] Loop state panel shows iteration, variable, condition (true/false)
- [ ] Output panel shows cumulative output with current line highlighted
- [ ] SharedViz components (CodePanel, StepProgress, StepControls) integrated
- [ ] CSS matches EventLoopViz visual patterns
- [ ] No auto-play functionality (step controls only per LOOP-01)
</success_criteria>

<output>
After completion, create `.planning/phases/02-loopsviz/02-01-SUMMARY.md`
</output>
